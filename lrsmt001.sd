%%
Screen
        Name = "LRSMT001" ;
        Type = "Detail" ;
        Padcharacter = Space ;
        Highlight = Underscore ;
        Screensize="dynamic" ;
        Windowtitle = "%a,     %s Claim Setup and Maintenance - Ver. 7.00     %m" ;
        Domain = "LRSSETUP" ;
--        resizeable = YES ;
        iconline=0;

        Global String G_COMPANY_ID[10],
                      G_CLAIMANT[50],
                      g_lib_1[10],
                      G_YESNO[1] ,
                      g_copy_name[15],
                      g_str_cat_no[10];

        Global Unsigned Ascii Number G_CLAIM_NO[11] ,
                                     G_SUB_CODE[4] ,
                                     G_POLICY_NO[9],
                                     G_PUB_ADJUST_NO[4],
                                     G_CAT_NO[5] ,
                                     G_YEAR[4],
                                     G_END_SEQUENCE[4],
                                     g_vendor_no[5] ,
                                     g_opt[2],
                                     g_scan[1] ;

        Global Signed Ascii Number G_AMOUNT[8],
                                   G_ULAE[8],
                                   G_ALAE[8] ;

        Global Date G_LOSS_DATE[8] ;
        global rwdate g_trans_date_2 ;

        global unsigned ascii number g_claim_setup[1] ;

        global YYYYMMDD Date g_calendar_date[8] ;

        Local Unsigned Ascii Number L_PRSMASTER_SUBCODE[2],
                                    l_pub_no[5],
                                    l_hold_policy_no[9],
                                    L_VENDOR_NO[5],
                                    l_note_count[3]=0,
                                    L_PRIOR_VENDOR_NO[5] ,
                                    L_YEAR[4],
                                    l_pending[2]=0,
                                    l_large_loss[1]=0,
                                    L_END_SEQUENCE[4] ,
                                    l_policy_no[9]=0,
                                    L_ALLOW_THEM_TO_CHANGE[1]=0,
                                    L_STATE[2],
                                    L_TRANS_TYPE[2]=01,
                                    L_DRIVER_SUB_CODE[4]=0,
                                    L_SUB_CODE[4]=0,
                                    l_last_sub_code[4]=0,
                                    L_HOLD_LOB[4]=0,
                                    L_HOLD_CAUSE_LOSS[4]=0,
                                    l_abort_program[1]=0,
                                    L_SUMMARY_SUB_CODE[4]=0/decimals=0;

        Local String L_NAME[30],
                     l_name_1[30],
                     l_prior_name[50],
                     l_pub[30],
                     l_different_claimant[1],
                     l_changed[1],
                     l_note_mess[50],
                     L_SEARCH_NAME[50] ,
                     l_activehelp[1]="Y",
                     L_DRIVER[50] ,
                     l_screen[9],
                     l_pending_payment[18],
                     l_dec[15],
                     l_pre_filled[1]="N",
                     L_LOCATION[9],
                     L_VEHICLE[1],
                     L_VALID_POLICY[1]="N",
                     L_PROP[1],
                     L_STATUS_2[22],
                     L_DESC[64],
                     L_LRSSUMMARY_STATUS[1]="O",
                     L_INSURDED[10] ,
                     L_REIN_COMPANY_ID[10]="",
                     L_CANCELLED[1] ,
                     L_REINS_OUTFILE[15],
                     L_COMMANDLINE[21]="",
                     L_HOLD_LOB_SUBLINE[2]="" ,
                     l_activehelp_lob_subline[2]="",
                     L_HOLD_CAUSE_SUBLINE[2]="",
                     l_system_id[15] = "",
                     l_continue[100] = "",
                     l_coverage[9]="Coverage:",
                     l_continue_1[3]="",
                     l_enter[1],
                     l_continue_2[3]="";

        Include "create_reserve.var"

        Include "sfscsexec.var"

        Include "scipsprint.var"

        include "virtualdecs.var"

        Access LRSSETUP, Set LRSSETUP:COMPANY_ID = G_COMPANY_ID,
                             LRSSETUP:CLAIM_NO   = G_CLAIM_NO ;

        include "stdkeys7.inc"

Style Definition

       Include "styles.inc"

Functions

        "redisplay" display/noreturn "lrsmt001" ;

        "claim3" sequence "getsub"                      Tagged notes_fn;
        "getsub" continue begin
                  g_company_id = lrssetup:company_id
                  g_claim_no = lrssetup:claim_no
                 -- do Get_last_subcode
                  do lrsdetail_subcode
                  display modal screen "lrsno001"
                  end ;

--        include "lrsclaimnotesfunc7.inc"

        Include "stdfunc7a.inc"
        Include "lrsclaimfunc7.inc"
        Include "lrsutilfunc7.inc"
        Include "lrscheckfunc7.inc"
        include "lrsstatusfunc7.inc"

        "util30" sequence "current_info"       tagged View_current_address_mort_info_fn;
        "current_info" continue begin
                                  G_POLICY_NO    = LRSSETUP:POLICY_NO
                                  if G_policy_no = 0 then
                                    {
                                      error ("Please search for a policy first")
                                    }
                                  display modal screen "sfppr300a"
                                end;

        "util7" sequence "prt" tagged view_print_dec_fn ;
        "prt" continue begin
                       g_opt = 4
                       do update_sfppolicy
                       display modal screen "sfppr300"
                       end ;

        "W" display "lrsmt01g" tagged change_status_fn ;

        "X" sequence "resync" tagged resync_detail_fn ;
        "resync" Continue Begin
                          l_continue_1 = Dialog("Resynchronize","warning.bmp","You are about to clear all summary data and resynchronize with detail, do you wish to continue?","Yes","No")
                          switch (l_continue_1)
                            Case "Yes" : begin
                                         Proc ("csbatch lrsup900 %s%s%s%s","01011900",Str(TODAYSDATE,"MMDDYYYY"),Str(LRSSETUP:CLAIM_NO,"99999999999"),LRSSETUP:COMPANY_ID)
                                         function = "redisplay"
                                         end
                            end
                          end ;

        "Z" sequence "credits" tagged remove_credits_fn ;
        "claim_work_flow" sequence "workflow" tagged  send_to_work_flow_fn;
        "workflow" continue BEGIN
                              if lrssetup:claim_no <> 0 and lrssetup:company_id one of "FLEMINGTON" then
                                {
                                  proc ("csbatch lrsup102 %s",str(lrssetup:claim_no))/noconsole
                                  warning ("Work flow has been updated")
                                }
                              else
                                {
                                  warning "Not a valid function"
                                }
                            end;

        "credits" Continue Begin
                           l_continue_1 = Dialog("Negative Reserves","warning.bmp","You are about to add transactions to back out negative reserves, do you wish to continue?","Yes","No")
                           switch (l_continue_1)
                             Case "Yes" : begin
                                          Proc ("csbatch lrsup900a %s%s%s%s","01011900",Str(TODAYSDATE,"MMDDYYYY"),Str(LRSSETUP:CLAIM_NO,"99999999999"),LRSSETUP:COMPANY_ID)
                                          function = "redisplay"
                                          end
                             end
                           end ;



Menu Definition

        Include "stdmenu7.inc"
        include "lrsclaimmenu7.inc"
        Include "lrsutilmenu7.inc"
        include "lrscheckmenu7.inc"

} -- must have this here to allow for application specific includes to be
  -- added above

Toolbar Definition

       Include "stdtoolbar7.inc"

}

        include "stdblanktoolbar7.inc"

}

        include "lrsclaimtoolbar7.inc"

}

Screen Entry
disable(delete_fn)

-- setting up users permissions on current screen here

include "lrssecurity.inc"

L_USERNAME = USERNAME
Access SFSEMAIL, Set SFSEMAIL:COMPANY_ID = LRSSETUP:COMPANY_ID,
                     SFSEMAIL:USER_ID = L_USERNAME, Generic

access sfsdefault, set sfsdefault:sfs_code = "SFS", generic

if sfsdefault:company_id <> "FLEMINGTON" then
    hide(ficof_cat)
else
    hide(cat)

Access Validation
L_USERNAME = USERNAME
Access SFSEMAIL, Set SFSEMAIL:COMPANY_ID = LRSSETUP:COMPANY_ID,
                     SFSEMAIL:USER_ID = L_USERNAME, Generic

Skip when SFSEMAIL:TPA = "Y" And
          SFSLINE:TPA = "N" ;

access sfscompany, set sfscompany:company_id = lrssetup:company_id, generic

if sfscompany:company_id <> "FLEMINGTON" then
  {
    disable(largeloss_fn)
    disable(send_to_work_flow_fn)
  }

screen at 2,1 to 20,100
Properties
        {
        LayoutType = Column
        }
{
Panel Tagged Header_pl
Properties
        {
        Borderstyle     = Raised
        ScrollBarPolicy = asneeded
        }
{
%%
                                                        _______________
*---------------------------------------------------------------------------------*
| Company ID:         ___________ _______________________________________________ |
| Date of Loss:       __________ Status: ______________________ Date: __________  |
| Claim Received:     __________ Non-SCIPS Policy: _            Large Loss:    _  |
| Policy No:          _________  _______________________________________________  |
| Agent No:           ____       _______________________________________________  |
| Line of Business:   ____  ___  _______________________________________________  |
| Cause of Loss:      ____  ___  _______________________________________________  |
| Condition:          __  ____________________                  _________   ____  |
| Comments:           __________________________________________________          |
| Non-SCIPS Claim No: __________                                                  |
| Claim No:           ___________^                                                |
| __________          __________________________________________________________  |
| __________          __________________________________________________________  |
| Driver:             __________________________________________________________  |
*---------------------------------------------------------------------------------*
|                     __________________     ___________________                  |
*---------------------------------------------------------------------------------*

%%

components

Fields
101     --begin
          --   if l_abort_program one of 1 then
            -- begin
              --   function = "RETURN"
             --end
        --end
        FUNCTION/noecho/showasguidetext;
301     Begin
          If FUNCTION = "ADD" Then
            {
            if sfsdefault:company_id = "FLEMINGTON" then
              hide (different_type_of_adjusters)
            }
        End

        LRSSETUP:COMPANY_ID/default
        Include "companyhlp.inc"
302     Trun(SFSCOMPANY:NAME[1]) ;

401     /*begin
        display modal screen "calendar"
        g_calendar_date = 0000.00.00
        end*/
        LRSSETUP:LOSS_DATE  Mandatory
        /*Properties
                   {
                   dropdowniconname="calendar.bmp"
                   }*/


        If LRSSETUP:LOSS_DATE > TODAYSDATE Then
            Error 1215 ;
--        activehelp using "calendar" ;
501     LRSSETUP:REPORTED_DATE  Mandatory Nochange
        If LRSSETUP:REPORTED_DATE < LRSSETUP:LOSS_DATE Or
           LRSSETUP:REPORTED_DATE  > TODAYSDATE  Then
            Error 1215 ;

--        activehelp using "calendar" ;
601     begin
            L_HOLD_LOB_SUBLINE   = LRSSETUP:LOB_SUBLINE
            L_HOLD_LOB           = LRSSETUP:LINE_OF_BUSINESS
            L_HOLD_CAUSE_LOSS    = LRSSETUP:CAUSE_OF_LOSS
            L_HOLD_CAUSE_SUBLINE = LRSSETUP:CAUSE_LOSS_SUBLINE
            l_policy_no = lrssetup:policy_no
            l_prior_name = lrssetup:name[1]
            if function = "CHANGE" then
              l_hold_policy_no = lrssetup:policy_no
        end
        LRSSETUP:POLICY_NO
        L_USERNAME = USERNAME
        Access SFSEMAIL, Set SFSEMAIL:COMPANY_ID = LRSSETUP:COMPANY_ID,
                             SFSEMAIL:USER_ID = L_USERNAME, Generic

        -- if TPA only allow them to see certain line of business otherwise
        -- display an error
        If SFSLINE_ALT2:TPA ="N" And
           SFSEMAIL:TPA = "Y" And
           LRSSETUP:POLICY_NO <> 0 Then
            Error 1212

        -- check sfpname to see if a valid policy within the date of loss entered
        -- if not display a screen so they can enter the name and address and
        -- any other information needed for this claim
        if lrssetup:policy_no <> l_policy_no and
           function one of "CHANGE" then
            begin
            do check_sfpname
            do change_lrssummary
            l_changed = "N"
            end

        If LRSSETUP:POLICY_NO <> 0 and
           function one of "ADD" Then
            Begin
            Do CHECK_SFPNAME
            If L_CANCELLED = "Y" Then
                Begin
                LRSSETUP:STATUS = "Z"
                LRSSETUP:CANCELLED_POLICY = 1
                warning "Policy has been cancelled"
                End
            Else
                Begin
                LRSSETUP:STATUS = "O"
                lrssetup:status_date = todaysdate
                LRSSETUP:CANCELLED_POLICY = 0
                End

            If L_VALID_POLICY = "N" Then
                Begin
                if l_pre_filled = "N" then
                    begin
                    l_continue_2 = dialog("Not on File","warning.bmp","Policy is not on file for loss date entered, Click YES to continue","Yes","No")
                    If l_continue_2 = "Yes" then
                        Begin
                        G_COMPANY_ID = LRSSETUP:COMPANY_ID
                        G_POLICY_NO = LRSSETUP:POLICY_NO
                        G_YEAR = Year(LRSSETUP:LOSS_DATE)
                        G_LOSS_DATE = LRSSETUP:LOSS_DATE
                        g_claim_setup = 1
                        Display Modal Screen "lrsmt100a"
                        With Initial Function "ADD"
                        LRSSETUP:POL_YEAR = G_YEAR
                        LRSSETUP:END_SEQUENCE = G_END_SEQUENCE

                        Access SFPNAME, Set SFPNAME:POLICY_NO = LRSSETUP:POLICY_NO,
                                            SFPNAME:POL_YEAR = LRSSETUP:POL_YEAR,
                                            SFPNAME:END_SEQUENCE = LRSSETUP:END_SEQUENCE, Generic

                        LRSSETUP:NAME[1] = SFPNAME:NAME[1]
                        LRSSETUP:LINE_OF_BUSINESS = SFPNAME:LINE_OF_BUSINESS
                        LRSSETUP:AGENT_NO = SFPNAME:AGENT_NO
                        LRSSETUP:IDP_POLICY = "Y"
                        LRSSETUP:EFF_DATE = SFPNAME:EFF_DATE
                        LRSSETUP:STATUS = "O"
                        LRSSETUP:STATUS_DATE = TODAYSDATE
                        LRSSETUP:CANCELLED_POLICY = 0
                        L_CANCELLED     = "N"
                        end
                    End
                else
                    begin
                    Access SFPNAME, Set SFPNAME:POLICY_NO    = LRSSETUP:POLICY_NO,
                                        SFPNAME:POL_YEAR     = LRSSETUP:POL_YEAR,
                                        SFPNAME:END_SEQUENCE = LRSSETUP:END_SEQUENCE, Generic

                    LRSSETUP:NAME[1] = SFPNAME:NAME[1]
                    lrssetup:pol_year = sfpname:pol_year
                    lrssetup:end_sequence = sfpname:end_sequence
                    LRSSETUP:LINE_OF_BUSINESS = SFPNAME:LINE_OF_BUSINESS
                    LRSSETUP:AGENT_NO = SFPNAME:AGENT_NO
                    LRSSETUP:IDP_POLICY = "Y"
                    LRSSETUP:EFF_DATE = SFPNAME:EFF_DATE
                    LRSSETUP:STATUS = "O"
                    LRSSETUP:STATUS_DATE = TODAYSDATE
                    LRSSETUP:CANCELLED_POLICY = 0
                    L_CANCELLED     = "N"
                    End
                End
            End  ;

502     LRSSETUP:IDP_POLICY/checkbox/values="N,Y"/displayonly;
503     begin
            l_large_loss = lrssetup:large_loss
        end
        lrssetup:large_loss/checkbox/values="0,1"
        hide if lrssetup:company_id <> "FLEMINGTON" ;

-- display if policy number not zero
602     Begin
        If FUNCTION = "ADD" Then
            Begin
            LRSSETUP:STATUS_2 = 0
            LRSSETUP:STATUS_DATE = TODAYSDATE
            End
        End
        LRSSETUP:NAME_SEARCH/displayonly/uppercase Nochange
        hide when LRSSETUP:POLICY_NO = 0 ;

-- search by name if policy number zero
602     Begin
        If FUNCTION = "ADD" Then
            Begin
            LRSSETUP:STATUS_2 = 0
            LRSSETUP:STATUS_DATE = TODAYSDATE
            Access SFPNAME_ALIAS, Set SFPNAME_ALIAS:NAME_KEY_1 = L_SEARCH_NAME, Using Second Index, Approximate

            End
        End
        L_SEARCH_NAME/uppercase
        hide when LRSSETUP:POLICY_NO <> 0 Or
                FUNCTION = "SEARCH"

        LRSSETUP:POLICY_NO = SFPNAME_ALIAS:POLICY_NO
        LRSSETUP:NAME[1]   = SFPNAME_ALIAS:NAME[1]

        Activehelp SFPNAME_ALIAS:NAME[1],
                   SFPNAME_ALIAS:POLICY_NO ;
602     LRSSETUP:NAME_SEARCH/displayonly ;
601     LRSSETUP:POLICY_NO/displayonly ;

701     LRSSETUP:AGENT_NO/displayonly

        access sfpname, set sfpname:policy_no = lrssetup:policy_no,
                            sfpname:pol_year = lrssetup:pol_year,
                            sfpname:End_sequence = lrssetup:end_sequence, generic

        access sfsagent, set sfsagent:company_id = sfpname:company_id,
                             sfsagent:agent_no = sfpname:agent_no, generic

        -- show screen if policy has another claim associated with it
        -- displaying the claim number
        G_POLICY_NO = LRSSETUP:POLICY_NO
        G_COMPANY_ID = LRSSETUP:COMPANY_ID
        If FUNCTION  = "ADD" Then
            Begin
            Access LRSSETUP_ALIAS, Set LRSSETUP_ALIAS:POLICY_NO = LRSSETUP:POLICY_NO, Generic

            If LRSSETUP_ALIAS:POLICY_NO = LRSSETUP:POLICY_NO And
               LRSSETUP:POLICY_NO <> 0 Then
                Display Modal Screen "lrsin01a"
            End  ;
702     Trun(SFSAGENT:NAME[1])/displayonly;

402     Begin
        Switch(LRSSETUP:STATUS_2)
          Case 1  : L_STATUS_2 = "Closed With Payment"
          Case 2  : L_STATUS_2 = "Closed without Payment"
          Default : L_STATUS_2 = If LRSSETUP:STATUS = "X" Then
                                     "Claim is Invalid"
                                 Else
                                 if lrssetup:status = "Z" then
                                     "Policy is Cancelled"
                                 else
                                 if lrssetup:status = "R" then
                                     "Claim is Reopened"
                                 else
                                     "Claim is Open"
          End
        End
        L_STATUS_2/displayonly ;
403     LRSSETUP:STATUS_DATE/displayonly ;

801     lrssetup:line_of_business/displayonly
        hide if sfsline:lob_code one of "CPORTFOLIO";

801     begin
            activehelp()
        end
        lrssetup:line_of_business
        hide if sfsline:lob_code not one of "CPORTFOLIO" or
                lrssetup:idp_policy = "Y"

        lrssetup:lob_subline = prsmaster:lob_subline

        Activehelp/errormessage="No Premium Records Available for this Policy"

         If ((PRSMASTER:POLICY_NO = LRSSETUP:POLICY_NO And
            PRSMASTER:TRANS_CODE < 17 And
            PRSMASTER:TRANS_EFF <= LRSSETUP:LOSS_DATE And
            PRSMASTER:TRANS_EXP >= LRSSETUP:LOSS_DATE) or
            l_cancelled = "Y") Then
            PRSMASTER:LINE_OF_BUSINESS
        Else
            NULL/heading="LOB"/width=4,

        If ((PRSMASTER:POLICY_NO = LRSSETUP:POLICY_NO And
           PRSMASTER:TRANS_CODE < 17 And
           PRSMASTER:TRANS_EFF <= LRSSETUP:LOSS_DATE And
           PRSMASTER:TRANS_EXP >= LRSSETUP:LOSS_DATE) or
           l_cancelled = "Y") Then
            PRSMASTER:LOB_SUBLINE
        Else
            NULL/width=5/heading="Subline",

        If ((PRSMASTER:POLICY_NO = LRSSETUP:POLICY_NO And
           PRSMASTER:TRANS_CODE < 17 And
           PRSMASTER:TRANS_EFF <= LRSSETUP:LOSS_DATE And
           PRSMASTER:TRANS_EXP >= LRSSETUP:LOSS_DATE) or
           l_cancelled = "Y") Then
            SFSLINE_alt1:DESCRIPTION
        Else
            NULL/width=30/heading="Description" ;

801     begin
            activehelp()
        end
        lrssetup:line_of_business
        hide if sfsline:lob_code not one of "CPORTFOLIO" or
                lrssetup:idp_policy = "N"

        lrssetup:lob_subline = prsmaster:lob_subline

        Activehelp--/errormessage="No Premium Records Available for this Policy"

        if sfsline:lob_subline <> "00" then
            sfsline:LINE_OF_BUSINESS
        else
            null/heading="LOB"/width=4,
        if sfsline:lob_subline <> "00" then
            sfsline:LOB_SUBLINE
        Else
            NULL/width=5/heading="Subline",
        if sfsline:lob_subline <> "00" then
            SFSLINE:DESCRIPTION
        Else
            NULL/width=30/heading="Description" ;

802     lrssetup:lob_subline/displayonly
        hide if sfsline:lob_code not one of "CPORTFOLIO" ;
802     Begin
        If FUNCTION = "ADD" Then
            Begin
            Activehelp()
            End

        End
        LRSSETUP:LOB_SUBLINE/default
        hide when LRSSETUP:IDP_POLICY = "Y"
        hide if sfsline:lob_code one of "CPORTFOLIO"

        If FUNCTION = "ADD" Then
            Begin
            L_USERNAME = USERNAME
            Access SFSEMAIL, Set SFSEMAIL:COMPANY_ID = LRSSETUP:COMPANY_ID,
                                 SFSEMAIL:USER_ID = L_USERNAME, Generic

            If SFSLINE:TPA = "Y" And
               SFSEMAIL:TPA = "Y" Then
                LRSSETUP:TPA_CLAIM = "Y"
            End

--        l_activehelp_lob_subline = prsmaster:lob_subline

/*        If (FUNCTION One Of "ADD" or
           (function one of "CHANGE" and
           lrssetup:lob_subline <> l_hold_lob_subline)) then
--           (function one of "CHANGE" and
--           l_hold_lob_subline <> prsmaster:lob_subline and
--           l_activehelp = "Y")) then
            Begin
            LRSSETUP:LOB_SUBLINE = PRSMASTER:LOB_SUBLINE
            L_PRSMASTER_SUBCODE  = PRSMASTER:SUB_CODE
            End*/

        Activehelp/errormessage="No Premium Records Available for this Policy"

         If ((PRSMASTER:POLICY_NO = LRSSETUP:POLICY_NO And
            PRSMASTER:TRANS_CODE < 17 And
            PRSMASTER:TRANS_EFF <= LRSSETUP:LOSS_DATE And
            PRSMASTER:TRANS_EXP >= LRSSETUP:LOSS_DATE) or
            l_cancelled = "Y") Then
            PRSMASTER:LINE_OF_BUSINESS
        Else
            NULL/heading="LOB"/width=4,

        If ((PRSMASTER:POLICY_NO = LRSSETUP:POLICY_NO And
           PRSMASTER:TRANS_CODE < 17 And
           PRSMASTER:TRANS_EFF <= LRSSETUP:LOSS_DATE And
           PRSMASTER:TRANS_EXP >= LRSSETUP:LOSS_DATE) or
           l_cancelled = "Y") Then
            PRSMASTER:LOB_SUBLINE
        Else
            NULL/width=5/heading="Subline"/returntofield,

        If ((PRSMASTER:POLICY_NO = LRSSETUP:POLICY_NO And
           PRSMASTER:TRANS_CODE < 17 And
           PRSMASTER:TRANS_EFF <= LRSSETUP:LOSS_DATE And
           PRSMASTER:TRANS_EXP >= LRSSETUP:LOSS_DATE) or
           l_cancelled = "Y") Then
            SFSLINE_ALT1:DESCRIPTION
        Else
            NULL/width=30/heading="Description",

        If ((PRSMASTER:POLICY_NO = LRSSETUP:POLICY_NO And
           PRSMASTER:TRANS_CODE < 17 And
           PRSMASTER:TRANS_EFF <= LRSSETUP:LOSS_DATE And
           PRSMASTER:TRANS_EXP >= LRSSETUP:LOSS_DATE) or
           l_cancelled = "Y") Then
            PRSMASTER:TRANS_EFF
        Else
            NULL/mask="MM/DD/YYYY"/width=12/heading="Eff Date",

        If ((PRSMASTER:POLICY_NO = LRSSETUP:POLICY_NO And
           PRSMASTER:TRANS_CODE < 17 And
           PRSMASTER:TRANS_EFF <= LRSSETUP:LOSS_DATE And
           PRSMASTER:TRANS_EXP >= LRSSETUP:LOSS_DATE) or
           l_cancelled = "Y") Then
            PRSMASTER:TRANS_DATE
        Else
            NULL/mask="MM/DD/YYYY"/width=12/heading="Trans Date",

        If ((PRSMASTER:POLICY_NO = LRSSETUP:POLICY_NO And
           PRSMASTER:TRANS_CODE < 17 And
           PRSMASTER:TRANS_EFF <= LRSSETUP:LOSS_DATE And
           PRSMASTER:TRANS_EXP >= LRSSETUP:LOSS_DATE) or
           l_cancelled = "Y") Then
            PRSMASTER:TRANS_CODE
        Else
            NULL/heading="Trans Code"/width=10 ;

802     Begin
        If FUNCTION = "ADD" Then
            Begin
            Activehelp()
            End
--        L_HOLD_LOB_SUBLINE = LRSSETUP:LOB_SUBLINE
--        L_HOLD_LOB = LRSSETUP:LINE_OF_BUSINESS
--        L_HOLD_CAUSE_LOSS = LRSSETUP:CAUSE_OF_LOSS
--        L_HOLD_CAUSE_SUBLINE = LRSSETUP:CAUSE_LOSS_SUBLINE
        End
        LRSSETUP:LOB_SUBLINE/default
        hide when LRSSETUP:IDP_POLICY = "N"
--        hide if sfsline:lob_code one of "CPORTFOLIO"

        If FUNCTION = "ADD" Then
            Begin
            L_USERNAME = USERNAME
            Access SFSEMAIL, Set SFSEMAIL:COMPANY_ID = LRSSETUP:COMPANY_ID,
                                 SFSEMAIL:USER_ID = L_USERNAME, Generic

            If SFSLINE:TPA = "Y" And
               SFSEMAIL:TPA = "Y" Then
                LRSSETUP:TPA_CLAIM = "Y"
            End

/*        If (FUNCTION One Of "ADD" or
           (function one of "CHANGE" and
           l_hold_lob <> lrssetup:line_of_business) or
           (function one of "CHANGE" and
           l_hold_lob_subline <> sfsline_alt:lob_subline)) Then
            Begin
            LRSSETUP:LOB_SUBLINE = SFSLINE_ALT:LOB_SUBLINE
            End*/

        Activehelp If SFSLINE_ALT:LOB_SUBLINE Not One Of "00", "99" And
                      SFSLINE_ALT:LINE_OF_BUSINESS = LRSSETUP:LINE_OF_BUSINESS Then
                       SFSLINE_ALT:LINE_OF_BUSINESS
                   Else
                       NULL/width=4/heading="LOB",
                   If SFSLINE_ALT:LOB_SUBLINE Not One Of "00", "99" And
                      SFSLINE_ALT:LINE_OF_BUSINESS = LRSSETUP:LINE_OF_BUSINESS Then
                       SFSLINE_ALT:LOB_SUBLINE
                   Else
                       NULL/returntofield/width=5/heading="Subline",
                   If SFSLINE_ALT:LOB_SUBLINE Not One Of "00", "99" And
                      SFSLINE_ALT:LINE_OF_BUSINESS = LRSSETUP:LINE_OF_BUSINESS Then
                       SFSLINE_ALT:DESCRIPTION
                   Else
                       NULL/width=30/heading="Description" ;

802     LRSSETUP:LOB_SUBLINE/displayonly ;
803     SFSLINE_ALIAS:DESCRIPTION;

901     Begin
        access sfscause, set sfscause:company_id = lrssetup:company_id,
                             sfscause:line_of_business = lrssetup:line_of_business,
                             sfscause:lob_subline = lrssetup:lob_subline,
                             sfscause:cause_of_loss = lrssetup:cause_of_loss, generic

        If FUNCTION one of "ADD" Then
            begin
            Activehelp ()
            end
        End
        LRSSETUP:CAUSE_OF_LOSS
        If LRSSETUP:CAUSE_OF_LOSS <> SFSCAUSE1:CAUSE_OF_LOSS Then
            Error 1214

        if function one of "ADD" then
            lrssetup:cause_loss_subline = sfscause:cause_loss_subline

        If FUNCTION One Of "ADD" Then
            Begin
            LRSSETUP:CAUSE_LOSS_SUBLINE = SFSCAUSE:CAUSE_LOSS_SUBLINE
            End

        Activehelp SFSCAUSE:CAUSE_OF_LOSS,
                   SFSCAUSE:CAUSE_LOSS_SUBLINE,
                   SFSCAUSE:DESCRIPTION ;
902     LRSSETUP:CAUSE_LOSS_SUBLINE/displayonly
        hide when function not one of "ADD" ;
902     lrssetup:cause_loss_subline
        hide when function one of "ADD"
        if lrssetup:cause_loss_subline <> sfscause2:cause_loss_subline then
            error "Invalid Cause of Loss Subline"

        activehelp sfscause1:cause_loss_subline,
                   sfscause1:cause_of_loss,
                   sfscause1:description ;
903     SFSCAUSE2:DESCRIPTION ;

1001    LRSSETUP:CONDITION/uppercase
        If LRSSETUP:CONDITION <> SFSCONDITION:CONDITION And
           LRSSETUP:CONDITION <> "" Then
            Error "Invalid Condition"

        Activehelp SFSCONDITION:CONDITION,
                   SFSCONDITION:DESCRIPTION ;
1002    begin
        access sfscompany, set sfscompany:company_id = lrssetup:company_id, generic
        end
        SFSCONDITION:DESCRIPTION;
1003    l_coverage/displayonly/showasguidetext
        hide if sfscompany:loss_coverage = 0 ;
1004    lrssetup:coverage/uppercase/showasguidetext
        hide if sfscompany:loss_coverage = 0 ;

1101    LRSSETUP:COMMENTS ;
1201    LRSSETUP:OTHER_SYSTEM_CLAIM_NUMBER nochange
        Helptext "This is for claims being entered that are not a SCIPS Claim";

1301    LRSSETUP:CLAIM_NO  {Nochange}
        hide when SFSDEFAULT:MANUAL_CLAIM_NO One Of 0 ;
1301    begin
        if lrssetup:other_system_claim_number <> 0 and
           sfscompany:other_system_claim_number = 1 then
            begin
            lrssetup:claim_no = lrssetup:other_system_claim_number
            lrssetup:converted_claim = 1
            end
        end
        LRSSETUP:CLAIM_NO/default  {Nochange}
        hide when ((lrssetup:other_system_claim_number <> 0 and
                sfscompany:other_system_claim_number = 0) or
                lrssetup:other_system_claim_number = 0);
1301    Begin
        If FUNCTION = "ADD" And
           LRSSETUP:CLAIM_NO = 0 And
           lrssetup:other_system_claim_number = 0 and
           SFSDEFAULT:MANUAL_CLAIM_NO One Of 0 Then
            Do GET_CLAIM_NO
        End
        LRSSETUP:CLAIM_NO/displayonly
        hide when (SFSDEFAULT:MANUAL_CLAIM_NO One Of 1 or
                (lrssetup:other_system_claim_number <> 0 and
                sfscompany:other_system_claim_number = 1))  ;
1302    SFSLINE:CLAIM_ALPHA ;

1401    Begin
        Access SFSCAUSE, Set SFSCAUSE:COMPANY_ID = LRSSETUP:COMPANY_ID ,
                             SFSCAUSE:LINE_OF_BUSINESS = LRSSETUP:LINE_OF_BUSINESS ,
                             SFSCAUSE:LOB_SUBLINE = LRSSETUP:LOB_SUBLINE ,
                             SFSCAUSE:CAUSE_OF_LOSS = LRSSETUP:CAUSE_OF_LOSS ,
                             SFSCAUSE:CAUSE_LOSS_SUBLINE = LRSSETUP:CAUSE_LOSS_SUBLINE , Generic

        If SFSCAUSE:LINE_TYPE not one of "W", "L" Then
            begin
            l_different_claimant = "N"
            L_INSURDED = "Insured"
            end
        Else
            begin
            l_different_claimant = "Y"
            L_INSURDED = "Claimant"
            end
        End
        L_INSURDED/displayonly/showasguidetext ;
1402    Begin
        If SFSCAUSE:LINE_TYPE not one of "W", "L" Then
            Begin
            Access SFPNAME, Set SFPNAME:POLICY_NO = LRSSETUP:POLICY_NO,
                                SFPNAME:POL_YEAR = SFPCURRENT:POL_YEAR,
                                SFPNAME:END_SEQUENCE = SFPCURRENT:END_SEQUENCE, Generic

            LRSSETUP:CLAIMANT = SFPNAME:NAME[1]
            End
        End
        LRSSETUP:CLAIMANT/displayonly/uppercase
        hide when SFSCAUSE:LINE_TYPE one of "W", "L";
1402    Begin
        If SFSCAUSE:LINE_TYPE one of "W", "L" And
           FUNCTION  = "ADD" Then
            Begin
            G_COMPANY_ID = LRSSETUP:COMPANY_ID
            G_CLAIM_NO = LRSSETUP:CLAIM_NO
            g_sub_code = 10
            Display Modal Screen "lrsmt104"
            With Initial Function "ADD|BACK"
            LRSSETUP:CLAIMANT = G_CLAIMANT
            End
        End
        LRSSETUP:CLAIMANT/default/uppercase/Style=Java_Hyperlink_blue
        Properties {
                   tooltip   = "This is the Claimant Assigned to this Claim"
                   StatusBarText = "Click Here to View the Claimant Details"
                   CursorShape   = HAND
                   }
                   events {
                          MouseClicked = Show_claimant
                          }
        hide when SFSCAUSE:LINE_TYPE not one of "W", "L" ;

1501    Begin
        If FUNCTION = "ADD" Or
           FUNCTION = "CHANGE" Then
            Begin
            If SYSTEM = "Win" Then
                Begin
                Proc("cli lrswork")/noconsole
                End
            Else
                Begin
                Proc("cli lrswork.mk")/noconsole
                End

            Do SETUP_LRSWORK
            End
        L_VEHICLE = "N"
        L_PROP = ""
        Switch(SFSLINE:BUSINESS_TYPE)
          Case "A" : Begin
                     L_LOCATION = "Vehicle"
                     L_VEHICLE = "Y"
                     End
          Default  : Begin
                     L_LOCATION = "Location"
                     L_PROP = "O"
                     End
          End
        End
        L_LOCATION/displayonly/showasguidetext ;

--   if claim is an commercial auto claim
1502    Begin
        Access CAPVEHICLE_ALIAS, Set CAPVEHICLE_ALIAS:POLICY_NO = LRSSETUP:POLICY_NO,
                                     CAPVEHICLE_ALIAS:POL_YEAR = LRSSETUP:POL_YEAR,
                                     CAPVEHICLE_ALIAS:END_SEQUENCE = LRSSETUP:END_SEQUENCE, generic

        If FUNCTION Not One Of "ADD" Then
            Begin
            Access LRSLOCATION, Set LRSLOCATION:COMPANY_ID = LRSSETUP:COMPANY_ID,
                                    LRSLOCATION:CLAIM_NO = LRSSETUP:CLAIM_NO, Generic

            If LRSLOCATION:COMPANY_ID = LRSSETUP:COMPANY_ID And
               LRSLOCATION:CLAIM_NO = LRSSETUP:CLAIM_NO Then
                Begin
                L_DESC = LRSLOCATION:DESCRIPTION
                End
            Else
                Begin
                If LRSSETUP:VEHICLE_NO <> 0 Then
                    Begin
                    Access CAPVEHICLE_ALIAS, Set CAPVEHICLE_ALIAS:POLICY_NO = LRSSETUP:POLICY_NO,
                                                 CAPVEHICLE_ALIAS:POL_YEAR = LRSSETUP:POL_YEAR,
                                                 CAPVEHICLE_ALIAS:END_SEQUENCE = LRSSETUP:END_SEQUENCE,
                                                 CAPVEHICLE_ALIAS:VEHICLE_NO = LRSSETUP:VEHICLE_NO, Generic

                    L_DESC = Trun(CAPVEHICLE_ALIAS:MAKE + " " + CAPVEHICLE_ALIAS:SERIAL_NO)
                    End
                Else
                    Begin
                    L_DESC = "Vehicle Not Listed"
                    End
                End

            End
        Else
            L_DESC = ""
        End
        L_DESC/default
        hide when L_VEHICLE <> "Y"

        if lrssetup:policy_no <> l_policy_no and
           function = "CHANGE" and
           l_desc = lrslocation:description then
            begin
            l_changed = "Y"
            error "You must change the vehicle information"
            end

        LRSSETUP:POL_YEAR = CAPVEHICLE_ALIAS:POL_YEAR
        LRSSETUP:END_SEQUENCE = CAPVEHICLE_ALIAS:END_SEQUENCE

        If L_DESC = "" Then
            LRSSETUP:VEHICLE_NO = 0
        Else
            LRSSETUP:VEHICLE_NO = CAPVEHICLE_ALIAS:VEHICLE_NO

        LRSSETUP:STATE = CAPVEHICLE_ALIAS:STATE
        if lrssetup:state = 0 then
            lrssetup:state = sfsdefault:state
        If CAPVEHICLE:CLASS_CODE = 7391 Then
            LRSSETUP:PRIVATE_PASSENGER = "Y"
        LRSSETUP:TERRITORY = CAPVEHICLE_ALIAS:TERRITORY
        If L_DESC = "" Then
            L_DESC = "Vehicle Not Listed"
        else
            if l_desc <> "Vehicle Not Listed" then
               L_DESC = Trun(CAPVEHICLE_ALIAS:MAKE + " " + CAPVEHICLE_ALIAS:SERIAL_NO)

        Access LRSLOCATION, Set LRSLOCATION:COMPANY_ID = LRSSETUP:COMPANY_ID,
                                LRSLOCATION:CLAIM_NO = LRSSETUP:CLAIM_NO, Generic

        If LRSLOCATION:COMPANY_ID = LRSSETUP:COMPANY_ID And
           LRSLOCATION:CLAIM_NO = LRSSETUP:CLAIM_NO Then
            Begin
            Change LRSLOCATION
                Begin
                LRSLOCATION:DESCRIPTION = L_DESC
                End
            End
        Else
            Begin
            Add LRSLOCATION
                Begin
                LRSLOCATION:COMPANY_ID = LRSSETUP:COMPANY_ID
                LRSLOCATION:CLAIM_NO = LRSSETUP:CLAIM_NO
                LRSLOCATION:DESCRIPTION = L_DESC
                End
            End

        Activehelp/autoplacement/line=4
        If CAPVEHICLE_ALIAS:POLICY_NO = LRSSETUP:POLICY_NO And
           L_VEHICLE = "Y" Then
            CAPVEHICLE_ALIAS:VEHICLE_NO
        Else
            NULL/width=7/heading="Vehicle",
        If CAPVEHICLE_ALIAS:POLICY_NO = LRSSETUP:POLICY_NO And
           L_VEHICLE = "Y" Then
            CAPVEHICLE_ALIAS:year
        Else
            NULL/width=7/heading="Year",
        If CAPVEHICLE_ALIAS:POLICY_NO = LRSSETUP:POLICY_NO And
           L_VEHICLE = "Y" Then
            Trun(CAPVEHICLE_ALIAS:MAKE + " " + CAPVEHICLE_ALIAS:SERIAL_NO)
        Else
            NULL/width=40/heading="Make"/returntofield,
        If CAPVEHICLE_ALIAS:POLICY_NO = LRSSETUP:POLICY_NO And
           L_VEHICLE = "Y" Then
            PRSMASTER:TRANS_EFF
        Else
            NULL/heading="Effective",
        If CAPVEHICLE_ALIAS:POLICY_NO = LRSSETUP:POLICY_NO And
           L_VEHICLE = "Y" Then
            PRSMASTER:TRANS_EXP
        Else
            NULL/width=10/heading="Expiration" ;

1502    Begin
        If FUNCTION <>  "ADD" Then
            Begin
            Access LRSLOCATION, Set LRSLOCATION:COMPANY_ID = LRSSETUP:COMPANY_ID,
                                    LRSLOCATION:CLAIM_NO = LRSSETUP:CLAIM_NO, Generic

            If LRSLOCATION:COMPANY_ID = LRSSETUP:COMPANY_ID And
               LRSLOCATION:CLAIM_NO = LRSSETUP:CLAIM_NO Then
                Begin
                L_DESC = LRSLOCATION:DESCRIPTION
                L_ALLOW_THEM_TO_CHANGE = LRSLOCATION:ALLOW_THEM_TO_CHANGE
                End
            Else
                Begin
                Access SFPLOCATION, Set SFPLOCATION:POLICY_NO = LRSSETUP:POLICY_NO ,
                                        SFPLOCATION:POL_YEAR  = LRSSETUP:POL_YEAR  ,
                                        SFPLOCATION:END_SEQUENCE = LRSSETUP:END_SEQUENCE ,
                                        SFPLOCATION:PREM_NO = LRSSETUP:PREM_NO,
                                        SFPLOCATION:BUILD_NO = LRSSETUP:BUILD_NO , Generic

                L_DESC = Trun(SFPLOCATION:ADDRESS) + " " +
                         Trun(SFPLOCATION:CITY) + " " +
                         Trun(SFPLOCATION:STR_STATE)
                LRSSETUP:STATE = SFPLOCATION:STATE
                if lrssetup:state = 0 then
                     lrssetup:state = sfsdefault:state
                l_allow_them_to_change = 0
                End
            End
        Else
            L_DESC = ""
        End
        l_desc/default
        hide when L_VEHICLE <> "N"

        if lrssetup:policy_no <> l_policy_no and
           function = "CHANGE" and
           l_desc = lrslocation:description then
            begin
            l_changed = "Y"
            error "You must change the location information"
            end

        if lrswork:company_id <> "" then
            begin
            LRSSETUP:VEHICLE_NO = 0
            LRSSETUP:POL_YEAR = LRSWORK:POL_YEAR
            LRSSETUP:END_SEQUENCE = LRSWORK:END_SEQUENCE
            LRSSETUP:PREM_NO = LRSWORK:PREM_NO
            LRSSETUP:BUILD_NO = LRSWORK:BUILD_NO
            LRSSETUP:STATE = LRSWORK:STATE
            if lrssetup:state = 0 and
               sfsline:lob_code one of "WORK" then
                lrssetup:state = wcpgeneral:state
            if lrssetup:state = 0 then
                lrssetup:state = sfsdefault:state
            L_ALLOW_THEM_TO_CHANGE = LRSWORK:ALLOW_THEM_TO_CHANGE
            end

        Access LRSLOCATION, Set LRSLOCATION:COMPANY_ID = LRSSETUP:COMPANY_ID,
                                LRSLOCATION:CLAIM_NO = LRSSETUP:CLAIM_NO, Generic

        If LRSLOCATION:COMPANY_ID = LRSSETUP:COMPANY_ID And
           LRSLOCATION:CLAIM_NO = LRSSETUP:CLAIM_NO Then
            Begin
            Change LRSLOCATION
                Begin
                LRSLOCATION:DESCRIPTION = L_DESC
                LRSLOCATION:ALLOW_THEM_TO_CHANGE = lrswork:allow_them_to_change
                End
            End
        Else
            Begin
            Add LRSLOCATION
                Begin
                LRSLOCATION:COMPANY_ID = LRSSETUP:COMPANY_ID
                LRSLOCATION:CLAIM_NO = LRSSETUP:CLAIM_NO
                LRSLOCATION:DESCRIPTION = L_DESC
                LRSLOCATION:ALLOW_THEM_TO_CHANGE = lrswork:allow_them_to_change
                End
            End

        Activehelp
        If LRSWORK:POLICY_NO = LRSSETUP:POLICY_NO And
           L_VEHICLE = "N" Then
            LRSWORK:address1
        Else
            NULL /width=85/heading="Location",
        If LRSWORK:POLICY_NO = LRSSETUP:POLICY_NO And
           L_VEHICLE = "N" Then
            LRSWORK:Policy_no
        Else
            NULL /width=10/heading="Policy No",
        If LRSWORK:POLICY_NO = LRSSETUP:POLICY_NO And
           L_VEHICLE = "N" Then
            LRSWORK:end_sequence
        Else
            NULL/width=8/heading="End Seq",
        If LRSWORK:POLICY_NO = LRSSETUP:POLICY_NO And
           L_VEHICLE = "N" Then
            LRSWORK:PREM_NO
        Else
            NULL /width=5/heading="Prem",
        If LRSWORK:POLICY_NO = LRSSETUP:POLICY_NO And
           L_VEHICLE = "N" Then
            LRSWORK:BUILD_NO
        Else
            NULL /width=5/heading="Build",
        If LRSWORK:POLICY_NO = LRSSETUP:POLICY_NO And
           L_VEHICLE = "N" Then
            LRSWORK:TRANS_EFF
        Else
            NULL/width=10/heading="Trans Eff"/mask="MM/DD/YYYY",
        If LRSWORK:POLICY_NO = LRSSETUP:POLICY_NO And
           L_VEHICLE = "N" Then
            LRSWORK:TRANS_EXP
        Else
            NULL /width=10/heading="Trans Exp"/mask="MM/DD/YYYY" ;

1502    L_DESC/default
        hide when allow_them_to_change = 0
        Access LRSLOCATION, Set LRSLOCATION:COMPANY_ID = LRSSETUP:COMPANY_ID,
                                LRSLOCATION:CLAIM_NO = LRSSETUP:CLAIM_NO, Generic

        If LRSLOCATION:COMPANY_ID = LRSSETUP:COMPANY_ID And
           LRSLOCATION:CLAIM_NO = LRSSETUP:CLAIM_NO Then
            Begin
            Change LRSLOCATION
                Begin
                LRSLOCATION:DESCRIPTION = L_DESC
                LRSLOCATION:ALLOW_THEM_TO_CHANGE = 1
                End
            End
        Else
            Begin
            Add LRSLOCATION
                Begin
                LRSLOCATION:COMPANY_ID = LRSSETUP:COMPANY_ID
                LRSLOCATION:CLAIM_NO = LRSSETUP:CLAIM_NO
                LRSLOCATION:DESCRIPTION = L_DESC
                LRSLOCATION:ALLOW_THEM_TO_CHANGE = 1
                End
            End   ;

1502    L_DESC/displayonly;

1601    Begin
            L_DRIVER = LRSDRIVER:NAME
        End
        L_DRIVER/default
        hide when L_VEHICLE <> "Y"
        If L_DRIVER = "" Then
            Begin
            L_DRIVER = "Driver Not Listed"
            L_DRIVER_SUB_CODE = 0
            End
        Else
            L_DRIVER_SUB_CODE = CAPDRIVER:SUB_CODE

        Activehelp
        If CAPDRIVER:POLICY_NO = LRSSETUP:POLICY_NO And
           L_VEHICLE = "Y" Then
            CAPDRIVER:NAME
        Else
            NULL/width=50/heading="Driver" ;
1601    Begin
        Access LRSDRIVER, Set LRSDRIVER:COMPANY_ID = LRSSETUP:COMPANY_ID,
                              LRSDRIVER:CLAIM_NO = LRSSETUP:CLAIM_NO, Generic

        If LRSDRIVER:COMPANY_ID <> LRSSETUP:COMPANY_ID Or
           LRSDRIVER:CLAIM_NO <> LRSSETUP:CLAIM_NO Then
            Add LRSDRIVER
                Begin
                LRSDRIVER:COMPANY_ID    = LRSSETUP:COMPANY_ID
                LRSDRIVER:CLAIM_NO      = LRSSETUP:CLAIM_NO
                LRSDRIVER:POLICY_NO     = LRSSETUP:POLICY_NO
                LRSDRIVER:POL_YEAR      = LRSSETUP:POL_YEAR
                LRSDRIVER:END_SEQUENCE  = LRSSETUP:END_SEQUENCE
                LRSDRIVER:SUB_CODE      = L_DRIVER_SUB_CODE
                LRSDRIVER:NAME          = L_DRIVER
                End
        Else
            Change LRSDRIVER
                Begin
                LRSDRIVER:SUB_CODE      = L_DRIVER_SUB_CODE
                LRSDRIVER:NAME          = L_DRIVER
                End
        End
        L_DRIVER/displayonly
        hide when L_VEHICLE <> "Y" ;

1801    begin
        access lrscheck, set lrscheck:company_id = lrssetup:company_id,
                             lrscheck:claim_no   = lrssetup:claim_no, generic

        l_pending = 0
        while lrscheck:company_id = lrssetup:company_id and
              lrscheck:claim_no   = lrssetup:claim_no
               begin
               if lrscheck:release_date = 0 and
                  lrscheck:release not one of "V" and
                  lrscheck:dont_print_check = 0 then
                   begin
                   l_pending  = l_pending + 1
                   g_sub_code = lrscheck:sub_code
                   end

                next lrscheck
                end

        if l_pending = 1 then
            l_pending_payment = "PENDING PAYMENT"
        else
        if l_pending > 1 then
            l_pending_payment = "PENDING PAYMENTS"
        else
        if l_pending = 0 then
            l_pending_payment = ""
        end
        l_pending_payment/showasguidetext/displayonly/Style=Java_Hyperlink_blue
        Properties {
                   tooltip   = "There are pending payments"
                   StatusBarText = "Click Here to View the Check Information"
                   CursorShape   = HAND
                   }
                   events {
                          MouseClicked = show_accounts_payable
                          } ;
1802    begin
            do get_notes
        end
        l_note_mess/showasguidetext/displayonly/Style=Java_Hyperlink_blue
        Properties {
                   tooltip   = "There are Notes"
                   StatusBarText = "Click Here to View the Note Information"
                   CursorShape   = HAND
                   }
                   events {
                          MouseClicked = show_notes
                          } ;



} -- end of Header_pl

CardDialog GUI at 1,1  tagged different_type_of_adjusters
Properties    {
              LayOutConstraints = Stretch
              }
{
Panel
Properties    {
              ScrollBarPolicy=asneeded
              Text               = "&Examiner"
              }
{
%%

*------------------------------------------------------------------------------*
| Examiner:         _____  ___________________________________________________ |
*------------------------------------------------------------------------------*

%%

Components

Fields
-- Examinor
0301    Begin
            Access SFSVENDOR_ALIAS, Set SFSVENDOR_ALIAS:COMPANY_ID = LRSSETUP:COMPANY_ID, Generic
        End
        LRSSETUP:VENDOR_NO[1]
        L_VENDOR_NO = LRSSETUP:VENDOR_NO[1]
        Access SFSVENDOR, Set SFSVENDOR:COMPANY_ID = LRSSETUP:COMPANY_ID ,
                              SFSVENDOR:VENDOR_NO = L_VENDOR_NO ,Generic

        L_NAME = SFSVENDOR:NAME[1]

        If LRSSETUP:VENDOR_NO[1] <> SFSVENDOR:VENDOR_NO Then
            Begin
            Display Modal Screen "sfsmt003"
            With Initial Function "ADD|BACK"
            End

        Activehelp SFSVENDOR_ALIAS:VENDOR_NO,
                   SFSVENDOR_ALIAS:NAME[1] ;
0302    begin
        L_VENDOR_NO = LRSSETUP:VENDOR_NO[1]
        Access SFSVENDOR, Set SFSVENDOR:COMPANY_ID = LRSSETUP:COMPANY_ID ,
                              SFSVENDOR:VENDOR_NO = L_VENDOR_NO ,Generic

        end
        SFSVENDOR:NAME[1]/Style=Java_Hyperlink_blue
        Properties {
                   tooltip   = "This is the Examiner Assigned to this Claim"
                   StatusBarText = "Click Here to View Details"
                   CursorShape   = HAND
                   }
                   events {
                          MouseClicked = Show_examiner
                          } ;

-- allow them to search by vendor name
0302    Begin
            Access SFSVENDOR_ALIAS, Set SFSVENDOR_ALIAS:NAME = L_NAME, Generic
        End
        L_NAME/uppercase/default
        hide when lrssetup:vendor_no[1] <> 0
        If L_NAME = "" Then
            Error 1259

        LRSSETUP:VENDOR_NO[1] = SFSVENDOR_ALIAS:VENDOR_NO

        Activehelp SFSVENDOR_ALIAS:NAME,
                   SFSVENDOR_ALIAS:VENDOR_NO  ;
0301    LRSSETUP:VENDOR_NO[1]/displayonly
        L_VENDOR_NO = 0
        L_NAME = " " ;

} -- end of Examiner Panel

Panel GUI at 1,1
Properties    {
              ScrollBarPolicy    = asneeded
              Text               = "&Adjuster"
              }
{
%%

*------------------------------------------------------------------------------*
| Adjuster:         _____  ___________________________________________________ |
*------------------------------------------------------------------------------*

%%

Components

Fields

0301    Begin
            L_PRIOR_VENDOR_NO = LRSSETUP:VENDOR_NO[2]

            Access SFSVENDOR1_ALIAS, Set SFSVENDOR1_ALIAS:COMPANY_ID = LRSSETUP:COMPANY_ID, Generic
        End
        LRSSETUP:VENDOR_NO[2]
        L_VENDOR_NO = LRSSETUP:VENDOR_NO[2]
        Access SFSVENDOR1, Set SFSVENDOR1:COMPANY_ID = LRSSETUP:COMPANY_ID ,
                               SFSVENDOR1:VENDOR_NO = L_VENDOR_NO ,Generic

        L_NAME = SFSVENDOR1:NAME[1]

        If LRSSETUP:VENDOR_NO[2] <> SFSVENDOR1:VENDOR_NO Then
            Begin
            Display Modal Screen "sfsmt003"
            With Initial Function "ADD|BACK"
            End

        Activehelp SFSVENDOR1_ALIAS:VENDOR_NO,
                   SFSVENDOR1_ALIAS:NAME[1] ;
0302    begin
        L_VENDOR_NO = LRSSETUP:VENDOR_NO[2]
        Access SFSVENDOR1, Set SFSVENDOR1:COMPANY_ID = LRSSETUP:COMPANY_ID ,
                               SFSVENDOR1:VENDOR_NO = L_VENDOR_NO ,Generic
        end
        SFSVENDOR1:NAME[1]/Style=Java_Hyperlink_blue
        Properties {
                   tooltip   = "This is the Adjuster Assigned to this Claim"
                   StatusBarText = "Click Here to View Details"
                   CursorShape   = HAND
                   }
                   events {
                          MouseClicked = Show_adjuster
                          }
        hide when LRSSETUP:VENDOR_NO[2] = 0 ;

0302    Begin
            Access SFSVENDOR1_ALIAS, Set SFSVENDOR1_ALIAS:NAME = L_NAME, Generic
        End
        L_NAME/uppercase/default
        hide when LRSSETUP:VENDOR_NO[2] <> 0

        LRSSETUP:VENDOR_NO[2] = SFSVENDOR1_ALIAS:VENDOR_NO

        Activehelp SFSVENDOR1_ALIAS:NAME[1],
                   SFSVENDOR1_ALIAS:VENDOR_NO  ;
0301    LRSSETUP:VENDOR_NO[2]/displayonly
        L_VENDOR_NO = 0
        L_NAME = " " ;

} -- end of Adjuster Panel

Panel GUI at 1,1
Properties    {
              ScrollBarPolicy    = asneeded
              Text               = "&Coverage"
              }
{
%%

*------------------------------------------------------------------------------*
| Coverage Opinion: _  _____  ________________________________________________ |
*------------------------------------------------------------------------------*

%%
Components

Fields
-- Coverage Opinion
0301    lrssetup:coverage_option/checkbox/values="N,Y" ;
0302    Begin
            Access SFSVENDOR4_ALIAS, Set SFSVENDOR4_ALIAS:COMPANY_ID = LRSSETUP:COMPANY_ID, Generic
        End
        LRSSETUP:VENDOR_NO[5]
        hide when lrssetup:coverage_option one of "N", ""
        L_VENDOR_NO = LRSSETUP:VENDOR_NO[5]
        Access SFSVENDOR4, Set SFSVENDOR4:COMPANY_ID = LRSSETUP:COMPANY_ID ,
                               SFSVENDOR4:VENDOR_NO = L_VENDOR_NO ,Generic

        If LRSSETUP:VENDOR_NO[5] <> SFSVENDOR4:VENDOR_NO Then
            Begin
            Display Modal Screen "sfsmt003"
            With Initial Function "ADD|BACK"
            End

        Activehelp SFSVENDOR4_ALIAS:VENDOR_NO,
                   SFSVENDOR4_ALIAS:NAME[1] ;
0303    begin
        L_VENDOR_NO = LRSSETUP:VENDOR_NO[5]
        Access SFSVENDOR4, Set SFSVENDOR4:COMPANY_ID = LRSSETUP:COMPANY_ID ,
                               SFSVENDOR4:VENDOR_NO = L_VENDOR_NO ,Generic
        end
        SFSVENDOR4:NAME[1]/Style=Java_Hyperlink_blue
        Properties {
                   tooltip   = "This is the Coverage Opinion Assigned to this Claim"
                   StatusBarText = "Click Here to View Details"
                   CursorShape   = HAND
                   }
                   events {
                          MouseClicked = Show_coverage_opinion
                          }
        hide when lrssetup:coverage_option one of "N", "" ;

-- search by name
0303    Begin
            Access SFSVENDOR4_ALIAS, Set SFSVENDOR4_ALIAS:NAME = L_NAME, Generic
        End
        L_NAME/uppercase /default
        hide when lrssetup:coverage_option one of "N", "" or
                LRSSETUP:VENDOR_NO[5] <> 0

        LRSSETUP:VENDOR_NO[5] = SFSVENDOR4_ALIAS:VENDOR_NO

        Activehelp SFSVENDOR4_ALIAS:NAME[1],
                   SFSVENDOR4_ALIAS:VENDOR_NO  ;
0302    LRSSETUP:VENDOR_NO[5]/displayonly
        hide when lrssetup:coverage_option one of "N", ""
        L_VENDOR_NO = 0
        L_NAME = " " ;

} -- end of Coverage Opinion

Panel GUI at 1,1
Properties    {
              ScrollBarPolicy    = asneeded
              Text               = "&Litigation"
              }
{
%%

*------------------------------------------------------------------------------*
| Litigation:     _  _____  ________________________________________________   |
*------------------------------------------------------------------------------*

%%
Components

Fields
-- litigation
0301    lrssetup:litigation/checkbox/values="N,Y" ;
0302    Begin
            Access SFSVENDOR2_ALIAS, Set SFSVENDOR2_ALIAS:COMPANY_ID = LRSSETUP:COMPANY_ID, Generic
        End
        LRSSETUP:VENDOR_NO[3]
        hide when lrssetup:litigation one of "N", ""
        L_VENDOR_NO = LRSSETUP:VENDOR_NO[3]
        Access SFSVENDOR2, Set SFSVENDOR2:COMPANY_ID = LRSSETUP:COMPANY_ID ,
                               SFSVENDOR2:VENDOR_NO = L_VENDOR_NO ,Generic

        If LRSSETUP:VENDOR_NO[3] <> SFSVENDOR2:VENDOR_NO Then
            Begin
            Display Modal Screen "sfsmt003"
            With Initial Function "ADD|BACK"
            End

        Activehelp SFSVENDOR2_ALIAS:VENDOR_NO,
                   SFSVENDOR2_ALIAS:NAME[1] ;
0303    begin
        L_VENDOR_NO = LRSSETUP:VENDOR_NO[3]
        Access SFSVENDOR2, Set SFSVENDOR2:COMPANY_ID = LRSSETUP:COMPANY_ID ,
                               SFSVENDOR2:VENDOR_NO = L_VENDOR_NO ,Generic

        end
        SFSVENDOR2:NAME[1]/Style=Java_Hyperlink_blue
        Properties {
                   tooltip   = "This is the Litigation Assigned to this Claim"
                   StatusBarText = "Click Here to View Details"
                   CursorShape   = HAND
                   }
                   events {
                          MouseClicked = Show_litigation
                          }
        hide when lrssetup:litigation one of "N", "" ;

-- search by name
0303    Begin
            Access SFSVENDOR2_ALIAS, Set SFSVENDOR2_ALIAS:NAME = L_NAME, Generic
        End
        L_NAME/uppercase /default
        hide when LRSSETUP:VENDOR_NO[3] <> 0 or
                lrssetup:litigation one of "N", ""

        LRSSETUP:VENDOR_NO[3] = SFSVENDOR2_ALIAS:VENDOR_NO

        Activehelp SFSVENDOR2_ALIAS:NAME[1],
                   SFSVENDOR2_ALIAS:VENDOR_NO  ;
0302    LRSSETUP:VENDOR_NO[3]/displayonly
        hide when lrssetup:litigation one of "N", ""
        L_VENDOR_NO = 0
        L_NAME = " " ;

}

Panel GUI at 1,1
Properties    {
              ScrollBarPolicy    = asneeded
              Text               = "&DJ"
              }
{
%%

*------------------------------------------------------------------------------*
| DJ:     _  _____  ________________________________________________           |
*------------------------------------------------------------------------------*

%%
Components

Fields
0301    lrssetup:dj/checkbox/values="N,Y" ;
0302    Begin
            Access SFSVENDOR3_ALIAS, Set SFSVENDOR3_ALIAS:COMPANY_ID = LRSSETUP:COMPANY_ID, Generic
        End
        LRSSETUP:VENDOR_NO[4]
        hide when lrssetup:dj one of "N", ""
        L_VENDOR_NO = LRSSETUP:VENDOR_NO[4]
        Access SFSVENDOR3, Set SFSVENDOR3:COMPANY_ID = LRSSETUP:COMPANY_ID ,
                               SFSVENDOR3:VENDOR_NO = L_VENDOR_NO ,Generic

        If LRSSETUP:VENDOR_NO[4] <> SFSVENDOR3:VENDOR_NO Then
            Begin
            Display Modal Screen "sfsmt003"
            With Initial Function "ADD|BACK"
            End

        Activehelp SFSVENDOR3_ALIAS:VENDOR_NO,
                   SFSVENDOR3_ALIAS:NAME[1] ;
0303    begin
        L_VENDOR_NO = LRSSETUP:VENDOR_NO[4]
        Access SFSVENDOR3, Set SFSVENDOR3:COMPANY_ID = LRSSETUP:COMPANY_ID ,
                               SFSVENDOR3:VENDOR_NO = L_VENDOR_NO ,Generic
        end
        SFSVENDOR3:NAME[1]/Style=Java_Hyperlink_blue
        Properties {
                   tooltip   = "This is the DJ Assigned to this Claim"
                   StatusBarText = "Click Here to View Details"
                   CursorShape   = HAND
                   }
                   events {
                          MouseClicked = Show_dj
                          }
        hide when lrssetup:dj one of "N", "" ;

-- search by name
0303    Begin
            Access SFSVENDOR3_ALIAS, Set SFSVENDOR3_ALIAS:NAME = L_NAME, Generic
        End
        L_NAME/uppercase /default
        hide when LRSSETUP:VENDOR_NO[4] <> 0 or
                lrssetup:dj one of "N", ""

        LRSSETUP:VENDOR_NO[4] = SFSVENDOR3_ALIAS:VENDOR_NO

        Activehelp SFSVENDOR3_ALIAS:NAME,
                   SFSVENDOR3_ALIAS:VENDOR_NO  ;
0302    LRSSETUP:VENDOR_NO[4]/displayonly
        hide when lrssetup:dj one of "N", ""
        L_NAME = " "
        L_VENDOR_NO = 0 ;

} -- end of DJ

Panel GUI at 1,1
Properties    {
              ScrollBarPolicy    = asneeded
              Text               = "&Plaintiff Atty"
              }
{
%%

*------------------------------------------------------------------------------*
| Plaintiff Atty:   _  _____  ________________________________________________ |
*------------------------------------------------------------------------------*

%%
Components

Fields
0301    lrssetup:plantiff/checkbox/values="0,1" ;
0302    Begin
            Access SFSVENDOR6_ALIAS, Set SFSVENDOR6_ALIAS:COMPANY_ID = LRSSETUP:COMPANY_ID, Generic
        End
        LRSSETUP:PLANTIFF_VENDOR
        hide when lrssetup:plantiff = 0
        L_VENDOR_NO = lrssetup:PLANTIFF_VENDOR
        Access SFSVENDOR6, Set SFSVENDOR6:COMPANY_ID = LRSSETUP:COMPANY_ID ,
                               SFSVENDOR6:VENDOR_NO = L_VENDOR_NO ,Generic

        If LRSSETUP:PLANTIFF_VENDOR <> SFSVENDOR6:VENDOR_NO Then
            Begin
            Display Modal Screen "sfsmt003"
            With Initial Function "ADD|BACK"
            End

        Activehelp SFSVENDOR6_ALIAS:VENDOR_NO,
                   SFSVENDOR6_ALIAS:NAME[1] ;
0303    begin
        L_VENDOR_NO = lrssetup:PLANTIFF_VENDOR
        Access SFSVENDOR6, Set SFSVENDOR6:COMPANY_ID = LRSSETUP:COMPANY_ID ,
                               SFSVENDOR6:VENDOR_NO = L_VENDOR_NO ,Generic
        end
        SFSVENDOR6:NAME[1]/Style=Java_Hyperlink_blue
        Properties {
                   tooltip   = "This is the Plaintiff Attorney Assigned to this Claim"
                   StatusBarText = "Click Here to View Details"
                   CursorShape   = HAND
                   }
                   events {
                          MouseClicked = Show_plaintiff_attorney
                          }
        hide when lrssetup:plantiff = 0 ;

-- search by name
0303    Begin
            Access SFSVENDOR6_ALIAS, Set SFSVENDOR6_ALIAS:NAME = L_NAME, Generic
        End
        L_NAME/uppercase /default
        hide when LRSSETUP:PLANTIFF_VENDOR <> 0 or
                lrssetup:plantiff = 0

        LRSSETUP:PLANTIFF_VENDOR = SFSVENDOR6_ALIAS:VENDOR_NO

        Activehelp SFSVENDOR6_ALIAS:NAME,
                   SFSVENDOR6_ALIAS:VENDOR_NO  ;
0302    LRSSETUP:PLANTIFF_VENDOR/displayonly
        hide when lrssetup:plantiff = 0
        L_NAME = " "
        L_VENDOR_NO = 0;

} -- end of Plaintiff Atty

Panel GUI at 1,1
Properties    {
              ScrollBarPolicy    = asneeded
              Text               = "&Subro / Salvage"
              }
{
%%

*------------------------------------------------------------------------------*
| Subro/Salvage:   _  _____  ________________________________________________  |
*------------------------------------------------------------------------------*

%%
Components

Fields

0301    lrssetup:subro_sal/checkbox/values="N,Y" ;
0302    Begin
            Access SFSVENDOR5_ALIAS, Set SFSVENDOR5_ALIAS:COMPANY_ID = LRSSETUP:COMPANY_ID, Generic
        End
        LRSSETUP:VENDOR_NO[6]
        hide when lrssetup:subro_sal one of "N", ""
        L_VENDOR_NO = LRSSETUP:VENDOR_NO[6]
        Access SFSVENDOR5, Set SFSVENDOR5:COMPANY_ID = LRSSETUP:COMPANY_ID ,
                               SFSVENDOR5:VENDOR_NO = L_VENDOR_NO ,Generic

        If LRSSETUP:VENDOR_NO[6] <> SFSVENDOR5:VENDOR_NO Then
            Begin
            Display Modal Screen "sfsmt003"
            With Initial Function "ADD|BACK"
            End

        Activehelp SFSVENDOR5_ALIAS:VENDOR_NO,
                   SFSVENDOR5_ALIAS:NAME[1] ;
0303    begin
        L_VENDOR_NO = LRSSETUP:VENDOR_NO[6]
        Access SFSVENDOR5, Set SFSVENDOR5:COMPANY_ID = LRSSETUP:COMPANY_ID ,
                               SFSVENDOR5:VENDOR_NO = L_VENDOR_NO ,Generic
        end
        SFSVENDOR5:NAME[1]/Style=Java_Hyperlink_blue
        Properties {
                   tooltip   = "This is the Subro/Salvage Assigned to this Claim"
                   StatusBarText = "Click Here to View Details"
                   CursorShape   = HAND
                   }
                   events {
                          MouseClicked = Show_subro_salvage
                          }
        hide when lrssetup:subro_sal one of "N", "" ;

-- search by name
0303    Begin
            Access SFSVENDOR5_ALIAS, Set SFSVENDOR5_ALIAS:NAME = L_NAME, Generic
        End
        L_NAME/uppercase /default
        hide when LRSSETUP:VENDOR_NO[6] <> 0 or
                lrssetup:subro_sal one of "N", ""

        LRSSETUP:VENDOR_NO[6] = SFSVENDOR5_ALIAS:VENDOR_NO

        Activehelp SFSVENDOR5_ALIAS:NAME[1],
                   SFSVENDOR5_ALIAS:VENDOR_NO  ;
0302    LRSSETUP:VENDOR_NO[6]/displayonly
        hide when lrssetup:subro_sal one of "N", ""
        L_VENDOR_NO = 0
        L_NAME = " " ;

} -- end of Subro / Salvage

Panel GUI at 1,1 tagged cat
Properties    {
              ScrollBarPolicy    = asneeded
              Text               = "C&AT"
              }
{
%%

*------------------------------------------------------------------------------*
| Cat No: _  _____  ________________________________________________           |
*------------------------------------------------------------------------------*

%%
Components

Fields
0301    lrssetup:cat/checkbox/values="0,1" ;
0302    begin
            activehelp()
        end
        LRSSETUP:CAT_NO
        hide when lrssetup:cat = 0
        If LRSSETUP:LOSS_DATE < LRSCAT:EFF_DATE And
           LRSSETUP:CAT_NO <> 0 Then
            Error "Loss date is before Cat Effective Date"
        If LRSSETUP:LOSS_DATE > LRSCAT:EXP_DATE And
           LRSSETUP:CAT_NO <> 0 Then
            Error "Loss date is after Cat Expiration Date"

        Activehelp LRSCAT:CAT_NO,
                   LRSCAT:DESCRIPTION,
                   LRSCAT:EFF_DATE,
                   LRSCAT:EXP_DATE ;
0302    begin
        if lrssetup:cat = 1 and
           lrssetup:cat_no = 0 then
            begin
            display modal screen "lrsmt108"
            with initial function "ADD|BACK"
            lrssetup:cat_no = g_cat_no
            end
        end
        lrssetup:cat_no/default
        hide when lrssetup:cat = 0
        If LRSSETUP:LOSS_DATE < LRSCAT:EFF_DATE And
           LRSSETUP:CAT_NO <> 0 Then
            Error "Loss date is before Cat Effective Date"
        If LRSSETUP:LOSS_DATE > LRSCAT:EXP_DATE And
           LRSSETUP:CAT_NO <> 0 Then
            Error "Loss date is after Cat Expiration Date" ;
0303    LRSCAT:DESCRIPTION/Style=Java_Hyperlink_blue
        Properties {
                   tooltip   = "This is the CAT Assigned to this Claim"
                   StatusBarText = "Click Here to View the CAT Details"
                   CursorShape   = HAND
                   }
                   events {
                          MouseClicked = Show_Cat
                          }
                          ;

} -- end of CAT

Panel GUI at 1,1 tagged ficof_cat
Properties    {
              ScrollBarPolicy    = asneeded
              Text               = "C&AT"
              }
{
%%

*------------------------------------------------------------------------------*
| Cat No: _  ____________  ________________________________________________    |
*------------------------------------------------------------------------------*

%%
Components

Fields
0301    lrssetup:cat/checkbox/values="0,1"
        if lrssetup:cat = 0 then
            begin
            lrssetup:str_cat_no = ""
            end ;
0302    begin
            activehelp()
        end
        LRSSETUP:STR_CAT_NO
        hide when lrssetup:cat = 0
        If LRSSETUP:LOSS_DATE < LRSCAT1:EFF_DATE And
           LRSSETUP:STR_CAT_NO <> "" Then
            Error "Loss date is before Cat Effective Date"
        If LRSSETUP:LOSS_DATE > LRSCAT1:EXP_DATE And
           LRSSETUP:STR_CAT_NO <> "" Then
            Error "Loss date is after Cat Expiration Date"

        Activehelp LRSCAT1:STR_CAT_NO,
                   LRSCAT1:DESCRIPTION,
                   LRSCAT1:EFF_DATE,
                   LRSCAT1:EXP_DATE ;
0302    begin
        if lrssetup:cat = 1 and
           lrssetup:str_cat_no = "" then
            begin
            display modal screen "lrsmt108a"
            with initial function "ADD|BACK"
            lrssetup:str_cat_no = g_str_cat_no
            end
        end
        lrssetup:str_cat_no/default
        hide when lrssetup:cat = 0
        If LRSSETUP:LOSS_DATE < LRSCAT1:EFF_DATE And
           LRSSETUP:STR_CAT_NO <> "" Then
            Error "Loss date is before Cat Effective Date"
        If LRSSETUP:LOSS_DATE > LRSCAT1:EXP_DATE And
           LRSSETUP:STR_CAT_NO <> "" Then
            Error "Loss date is after Cat Expiration Date" ;
0303    LRSCAT1:DESCRIPTION/Style=Java_Hyperlink_blue
        Properties {
                   tooltip   = "This is the CAT Assigned to this Claim"
                   StatusBarText = "Click Here to View the CAT Details"
                   CursorShape   = HAND
                   }
                   events {
                          MouseClicked = Show_Cat_str
                          }
                          ;

} -- end of CAT

Panel GUI at 1,1
Properties    {
              ScrollBarPolicy    = asneeded
              Text               = "P&ublic Adjuster"
              }
{
%%

*-------------------------------------------------------------------------------*
| Public Adjuster: _  __________ _________________________________  _____ _____ |
*-------------------------------------------------------------------------------*

%%
Components

Fields
0301    lrssetup:pa/checkbox/values="N,Y" ;
0302    Begin
        If ((FUNCTION  = "ADD" Or
           FUNCTION = "CHANGE") And
           LRSSETUP:PUB_ADJUST_DATE = 0) Then
            LRSSETUP:PUB_ADJUST_DATE = TODAYSDATE
        End
        LRSSETUP:PUB_ADJUST_DATE/default
        hide when lrssetup:pa one of "N", "" ;
0303    begin
        if function one of "ADD", "CHANGE", "CHG" then
          begin
            l_name_1 = " "
            access lrspubadj_alt2, set lrspubadj_alt2:name = l_name_1, approximate

          end
        end
        l_name/default
        hide when lrssetup:pa one of "N", ""
        lrssetup:pub_adjust_no = lrspubadj_alt2:pub_adjust_no

        activehelp lrspubadj_alt2:name[1]/returntofield ;
0303    begin
        if function not one of "ADD", "CHANGE", "CHG" then
        begin
         if lrssetup:pub_adjust_no > 0 then
          begin
            access lrspubadj, set lrspubadj:company_id    = lrssetup:company_id,
                                  lrspubadj:pub_adjust_no = lrssetup:pub_adjust_no, generic

            l_name = lrspubadj:name[1]
          end
        end
        end
        l_name/displayonly ;


--0304    lrssetup:pub_adjust_no/displayonly
  --      hide when lrssetup:pa one of "N", "" ;

0304    LRSSETUP:PUB_ADJUST_NO/default
        hide when lrssetup:pa one of "N", ""
         if lrssetup:pub_adjust_no = 0 and
           lrssetup:pa = "Y" then
            begin
            display modal screen "lrsmt107"
            lrssetup:pub_adjust_no = g_pub_adjust_no
            end ;
--          activehelp  lrspubadj:pub_adjust_no/returntofield ;

0305    trun(LRSPUBADJ:NAME[1])/Style=Java_Hyperlink_blue
        Properties {
                   tooltip   = "This is the Public Adjuster Assigned to this Claim"
                   StatusBarText = "Click Here to View the Public Adjuster Details"
                   CursorShape   = HAND
                   }
                   events {
                          MouseClicked = Show_PA
                          }
        hide when lrssetup:pa one of "N", "" ;


} -- end of Public Adjuster

}

}-- end of the complete screen including card dialogs and header panel

Postupdate
Begin
If Abort    = "NO" And
   UPDATEOK = "YES"  Then
    Begin
    if function one of "ADD", "CHANGE" and
       lrssetup:company_id = "FLEMINGTON" then
        begin
        if lrssetup:large_loss = 1 and
           l_large_loss = 0 then
            begin
            g_company_id = lrssetup:company_id
            g_claim_no   = lrssetup:claim_no
            display modal screen "lrsmt01h"
            with initial function "ADD|BACK"
            end
        end

    if function one of "ADD" then
        begin
        if sfsline:lob_code one of "WORK" and
           sfsdefault:claims_workers_comp_screen = 1 then
            begin
            -- workers comp information for Lebanon
            access lrsworkerscomp, set lrsworkerscomp:company_id = lrssetup:company_id,
                                       lrsworkerscomp:claim_no   = lrssetup:claim_no, generic

            if lrsworkerscomp:company_id <> lrssetup:company_id or
               lrsworkerscomp:claim_no <> lrssetup:claim_no then
                begin
                g_company_id = lrssetup:company_id
                g_claim_no   = lrssetup:claim_No
                display modal screen "lrsmt199"
                with initial function "ADD|BACK"
                end
            end
        end

    If FUNCTION = "CHANGE" Then
        Begin
        If L_HOLD_LOB           <> LRSSETUP:LINE_OF_BUSINESS Or
           L_HOLD_LOB_SUBLINE   <> LRSSETUP:LOB_SUBLINE Or
           L_HOLD_CAUSE_LOSS    <> LRSSETUP:CAUSE_OF_LOSS Or
           L_HOLD_CAUSE_SUBLINE <> LRSSETUP:CAUSE_LOSS_SUBLINE Then
            Begin
            Warning "You are about to change detail records, are you sure you wish to do this, press CANCEL to continue"
            If Abort = "NO" Then
                Begin
                Do CHANGE_LRSDETAIL
                End
            Else
                FUNCTION = "abort"
            End
        if l_hold_policy_no <> lrssetup:policy_no then
          begin
            -- to subtract claim counter
            Do Decrease_SFPNAME

          end

        End

    If FUNCTION = "ADD" Then
       Begin
          -- to increment claim counter
          Do UPDATE_SFPNAME

          -- setup reserves, allow them to do this even if invalid policy or
          -- policy cancelled, they can put zero's in the fields if they do
          -- not want to setup reserves

          G_COMPANY_ID = LRSSETUP:COMPANY_ID
          G_CLAIM_NO = LRSSETUP:CLAIM_NO
          if G_company_id not one of "FLEMINGTON" then
            {
              Display Modal Screen "lrsmt01b"
              With Initial Function "Change|Back"
              Do CREATE_RESERVE
            }
          If SFSLINE_ALIAS:LOB_CODE Not One Of "BOILER" Then
               Do PROCESS_REINSURANCE
       End

    if FUNCTION one of "CHANGE" AND g_company_id one of "FLEMINGTON" THEN
      BEGIN
        access lrssummary,
           set LRSSUMMARY:COMPANY_ID         = LRSSETUP:COMPANY_ID,
               LRSSUMMARY:CLAIM_NO           = LRSSETUP:CLAIM_NO,
               LRSSUMMARY:LINE_OF_BUSINESS   = LRSSETUP:LINE_OF_BUSINESS,
               LRSSUMMARY:LOB_SUBLINE        = LRSSETUP:LOB_SUBLINE,
               LRSSUMMARY:CAUSE_OF_LOSS      = LRSSETUP:CAUSE_OF_LOSS,
               LRSSUMMARY:CAUSE_LOSS_SUBLINE = LRSSETUP:CAUSE_LOSS_SUBLINE, generic

       if LRSSUMMARY:COMPANY_ID         <> LRSSETUP:COMPANY_ID or
          LRSSUMMARY:CLAIM_NO           <> LRSSETUP:CLAIM_NO or
          LRSSUMMARY:LINE_OF_BUSINESS   <> LRSSETUP:LINE_OF_BUSINESS or
          LRSSUMMARY:LOB_SUBLINE        <> LRSSETUP:LOB_SUBLINE or
          LRSSUMMARY:CAUSE_OF_LOSS      <> LRSSETUP:CAUSE_OF_LOSS or
          LRSSUMMARY:CAUSE_LOSS_SUBLINE <> LRSSETUP:CAUSE_LOSS_SUBLINE then
         {
           g_company_id = lrssetup:company_id
           g_claim_no = lrssetup:claim_no
           Display Modal Screen "lrsmt01b"
           With Initial Function "Change|Back"
           Do CREATE_RESERVE
           If SFSLINE_ALIAS:LOB_CODE Not One Of "BOILER" Then
               Do PROCESS_REINSURANCE
         }
      END

    FUNCTION = "redisplay"
    End

End

Screen Exit
If LRSSETUP:COMPANY_ID > "" Then G_COMPANY_ID = LRSSETUP:COMPANY_ID ;
If LRSSETUP:CLAIM_NO   > 0  Then G_CLAIM_NO   = LRSSETUP:CLAIM_NO ;
If LRSSETUP:POLICY_NO  > 0  Then G_POLICY_NO  = LRSSETUP:POLICY_NO ;

Procedure Definition

procedure change_lrssummary
begin
if l_different_claimant = "N" then
    begin
    Access SFPCURRENT, Set SFPCURRENT:POLICY_NO = LRSSETUP:POLICY_NO, Exact

    Access SFPLOCATION, Set SFPLOCATION:POLICY_NO    = LRSSETUP:POLICY_NO ,
                            SFPLOCATION:POL_YEAR     = LRSSETUP:POL_YEAR  ,
                            SFPLOCATION:END_SEQUENCE = LRSSETUP:END_SEQUENCE ,
                            SFPLOCATION:PREM_NO      = LRSSETUP:PREM_NO,
                            SFPLOCATION:BUILD_NO     = LRSSETUP:BUILD_NO , Generic

    access sfpname, set sfpname:policy_no    = sfpcurrent:policy_no,
                        sfpname:pol_year     = sfpcurrent:pol_year,
                        sfpname:end_sequence = sfpcurrent:end_sequence, generic

    access lrssummary, set lrssummary:company_id = lrssetup:company_id,
                           lrssummary:claim_no   = lrssetup:claim_no, generic

    while lrssummary:company_id = lrssetup:company_id and
          lrssummary:claim_no   = lrssetup:claim_no
        begin
        if lrssummary:claimant <> lrssetup:name[1] then
            begin
            change lrssummary
                begin
                lrssummary:claimant = lrssetup:name[1]
                end
            end

        next lrssummary
        end

    access lrscmnt, set lrscmnt:company_id = lrssetup:company_id,
                        lrscmnt:claim_no   = lrssetup:claim_no, generic

    if lrscmnt:company_id = lrssetup:company_id and
       lrscmnt:claim_no   = lrssetup:claim_no then
        begin
        if lrscmnt:name[1] <> lrssetup:name[1] then
            begin
            change lrscmnt
                begin
                lrscmnt:name[1]     = lrssetup:name[1]
                lrscmnt:address[1]  = sfplocation:address
                lrscmnt:city        = sfplocation:city
                lrscmnt:str_state   = sfplocation:str_state
                lrscmnt:str_zipcode = sfplocation:str_zipcode
                end
            end
        end
    end

end

procedure update_sfppolicy
begin
if g_opt one of 1, 4, 5 then
    begin
    g_company_id = lrssetup:company_id
    if g_opt = 1 then
        g_scan = 1
    else
        g_scan = 0
    g_copy_name = ""
    display modal screen "sfppr400"
    with initial function "ADD|BACK"
    end

if g_opt not one of 10, 11 then
    begin
    proc("cli sfppolicy.mk")/noconsole
    l_username = username
    access sfppolicy,
       set sfppolicy:user_id          = l_username,
           sfppolicy:line_of_business = lrssetup:line_of_business, generic


    do get_latest_term_before_date_of_loss
    access sfpname,
       set sfpname:policy_no    = lrssetup:policy_no,
           sfpname:pol_year     = lrssetup:pol_year,   --this pol_year is the correct year it is put in here when claim was added to the system
           sfpname:end_sequence = l_end_sequence, generic

    if sfppolicy:user_id          <> l_username or
       sfppolicy:line_of_business <> lrssetup:line_of_business then
        begin
        add sfppolicy
            begin
            sfppolicy:user_id                   = l_username/raw
            sfppolicy:line_of_business          = lrssetup:line_of_business
            sfppolicy:policy_no                 = lrssetup:policy_no
            sfppolicy:pol_Year                  = lrssetup:pol_year
            sfppolicy:end_sequence              = l_end_sequence
            sfppolicy:copy_name                 = g_copy_name/raw
            sfppolicy:company_id                = lrssetup:company_id/raw
            if g_opt one of 1, 3 or
               g_scan = 1 then
                sfppolicy:scan_home_office_copy = 1
            end
        end
    else
        begin
        delete sfppolicy
        add sfppolicy
            begin
            sfppolicy:user_id                   = l_username/raw
            sfppolicy:line_of_business          = lrssetup:line_of_business
            sfppolicy:policy_no                 = lrssetup:policy_no
            sfppolicy:pol_Year                  = lrssetup:pol_year
            sfppolicy:end_sequence              = l_end_sequence
            sfppolicy:copy_name                 = ""/raw
            sfppolicy:company_id                = lrssetup:company_id/raw
            if g_opt one of 1, 3 or
               g_scan = 1 then
              {
                sfppolicy:scan_home_office_copy = 1
              }
            end
        end
    end
end

procedure get_latest_term_before_date_of_loss

--this procedure will start the one that was put into lrssetup when the claim was setup.
--this will be a starting point to see if there are any othere endorsements that are transacted after this but are effect before or equal
--to the loss date

BEGIN
  access sfpmaster,                                      --start with the
     set sfpmaster:policy_no    = lrssetup:policy_no,
         sfpmaster:pol_year     = lrssetup:pol_year,
         sfpmaster:end_sequence = lrssetup:end_sequence, exact

  l_end_sequence = lrssetup:end_sequence

  while sfpmaster:policy_no    = lrssetup:policy_no and
        sfpmaster:pol_year     = lrssetup:pol_year
    {
      if sfpmaster:trans_eff <= lrssetup:loss_date then
        {
          l_end_sequence = lrssetup:end_sequence
        }
      next sfpmaster
    }
END

procedure get_notes
begin
access lrsnotes, set lrsnotes:company_id = lrssetup:company_id,
                     lrsnotes:claim_no = lrssetup:claim_no, generic

l_note_count = 0
repeat
begin
  if lrsnotes:company_id = lrssetup:company_id and
     lrsnotes:claim_no   = lrssetup:claim_no then
           begin
               l_note_count  = l_note_count + 1
           end
  next lrsnotes
end
until lrsnotes:company_id <> lrssetup:company_id or
           lrsnotes:claim_no <> lrssetup:claim_no

if l_note_count > 0 then
   l_note_mess = str(l_note_count) + " Notes on Claim"
else
   l_note_mess = ""
end

Procedure CREATE_RESERVE
Begin
Access LRSRESV, Set LRSRESV:COMPANY_ID          = LRSSETUP:COMPANY_ID,
                    LRSRESV:LINE_OF_BUSINESS    = LRSSETUP:LINE_OF_BUSINESS,
                    LRSRESV:LOB_SUBLINE         = LRSSETUP:LOB_SUBLINE ,
                    LRSRESV:CAUSE_OF_LOSS       = LRSSETUP:CAUSE_OF_LOSS,
                    LRSRESV:CAUSE_LOSS_SUBLINE  = LRSSETUP:CAUSE_LOSS_SUBLINE, Generic

While LRSRESV:COMPANY_ID         = LRSSETUP:COMPANY_ID And
      LRSRESV:LINE_OF_BUSINESS   = LRSSETUP:LINE_OF_BUSINESS And
      LRSRESV:LOB_SUBLINE        = LRSSETUP:LOB_SUBLINE And
      LRSRESV:CAUSE_OF_LOSS      = LRSSETUP:CAUSE_OF_LOSS And
      LRSRESV:CAUSE_LOSS_SUBLINE = LRSSETUP:CAUSE_LOSS_SUBLINE
        Begin
        L_CASE_AMOUNT = LRSRESV:CASE_AMOUNT
        L_LAE_AMOUNT  = LRSRESV:LAE_AMOUNT
        L_ULAE        = LRSRESV:ULAE
        L_ALAE        = LRSRESV:ALAE

        Next LRSRESV
        End

Do LRSDETAIL_SUBCODE

-- setup loss resv
L_VENDOR = 0
L_ULAE   = "N"
L_ALAE   = "N"
If G_YESNO = "Y" Then
    L_RESV = L_CASE_AMOUNT
Else
    L_RESV = G_AMOUNT
Do SETUP_LRSDETAIL

-- setup alae resv
If G_ALAE > 0 Then
    Begin
    L_VENDOR = LRSSETUP:VENDOR_NO[2]
    L_ALAE = "Y"
    L_ULAE = "N"
    L_RESV = G_ALAE
    Do LRSDETAIL_SUBCODE
    Do SETUP_LRSDETAIL
    End

-- setup ulae resv
If G_ULAE > 0 Then
    Begin
    L_VENDOR = LRSSETUP:VENDOR_NO[2]
    L_ULAE = "Y"
    L_ALAE = "N"
    L_RESV = G_ULAE
    Do LRSDETAIL_SUBCODE
    Do SETUP_LRSDETAIL
    End

If G_YESNO = "Y" Then
    L_RESV = L_CASE_AMOUNT
Else
    L_RESV = G_AMOUNT
Do LRSSUMMARY_SUBCODE
Do SETUP_LRSSUMMARY

If SFSCAUSE:LINE_TYPE not one of "W", "L" Then
    Begin
    Do LRSCMNT_SUBCODE
    Do SETUP_LRSCMNT
    End

End

Procedure LRSDETAIL_SUBCODE
Begin
Access LRSDETAIL, Set LRSDETAIL:COMPANY_ID = LRSSETUP:COMPANY_ID ,
                      LRSDETAIL:CLAIM_NO   = LRSSETUP:CLAIM_NO, Generic

L_DETAIL_SUB_CODE = 0
While LRSDETAIL:COMPANY_ID = LRSSETUP:COMPANY_ID And
      LRSDETAIL:CLAIM_NO   = LRSSETUP:CLAIM_NO
        Begin

        L_DETAIL_SUB_CODE = LRSDETAIL:SUB_CODE

        Next LRSDETAIL
        End
l_last_sub_code = l_detail_sub_code
--g_sub_code = l_last_sub_code
L_DETAIL_SUB_CODE = L_DETAIL_SUB_CODE + 10
End

Procedure SETUP_LRSDETAIL
Begin
Add LRSDETAIL
    Begin
    LRSDETAIL:COMPANY_ID                =       LRSSETUP:COMPANY_ID/raw
    LRSDETAIL:CLAIM_NO                  =       LRSSETUP:CLAIM_NO
    LRSDETAIL:SUB_CODE                  =       L_DETAIL_SUB_CODE
    LRSDETAIL:TRANS_DATE                =       TODAYSDATE
    LRSDETAIL:BATCH                     =       1
    LRSDETAIL:USER_ID                   =       USERNAME/raw
    LRSDETAIL:SYSTEM_DATE               =       TODAYSDATE
    LRSDETAIL:MISC                      =       "INITAL RESERVE SETUP"/raw
    LRSDETAIL:LINE_OF_BUSINESS          =       LRSSETUP:LINE_OF_BUSINESS
    LRSDETAIL:LOB_SUBLINE               =       LRSSETUP:LOB_SUBLINE/raw
    LRSDETAIL:CAUSE_OF_LOSS             =       LRSSETUP:CAUSE_OF_LOSS
    LRSDETAIL:CAUSE_LOSS_SUBLINE        =       LRSSETUP:CAUSE_LOSS_SUBLINE/raw
    LRSDETAIL:SUMMARY_SUB_CODE          =       L_SUMMARY_SUB_CODE
    LRSDETAIL:VENDOR_NO                 =       L_VENDOR
    LRSDETAIL:TRANS_CODE                =       16
    LRSDETAIL:REINS_CO                  =       0
    If L_ULAE = "N" And
       L_ALAE = "N" Then
        LRSDETAIL:LOSS_RESV             =       L_RESV
    If L_ULAE = "Y" Or
       L_ALAE = "Y" Then
        LRSDETAIL:LAE_RESV              =       L_RESV
    LRSDETAIL:ULAE                      =       L_ULAE
    LRSDETAIL:ALAE                      =       L_ALAE
    LRSDETAIL:SUBRO                     =       "N"
    LRSDETAIL:SALVAGE                   =       "N"
    lrsdetail:coverage                  =       lrssetup:coverage/raw
    lrsdetail:expansion                 =       ""/raw
    End

End

Procedure SETUP_LRSSUMMARY
Begin
Add LRSSUMMARY
    Begin
    LRSSUMMARY:COMPANY_ID               =       LRSSETUP:COMPANY_ID/raw
    LRSSUMMARY:CLAIM_NO                 =       LRSSETUP:CLAIM_NO
    LRSSUMMARY:LINE_OF_BUSINESS         =       LRSSETUP:LINE_OF_BUSINESS
    LRSSUMMARY:LOB_SUBLINE              =       LRSSETUP:LOB_SUBLINE/raw
    LRSSUMMARY:CAUSE_OF_LOSS            =       LRSSETUP:CAUSE_OF_LOSS
    LRSSUMMARY:CAUSE_LOSS_SUBLINE       =       LRSSETUP:CAUSE_LOSS_SUBLINE/raw
    LRSSUMMARY:TRANS_TYPE               =       L_TRANS_TYPE
    LRSSUMMARY:SUB_CODE                 =       L_SUMMARY_SUB_CODE
    LRSSUMMARY:CLAIMANT                 =       LRSSETUP:CLAIMANT/raw
    LRSSUMMARY:LOSS_RESV                =       L_RESV
    LRSSUMMARY:LOSS_PAID                =       0
    LRSSUMMARY:ULAE_RESV                =       G_ULAE
    LRSSUMMARY:ULAE_PAID                =       0
    LRSSUMMARY:ALAE_RESV                =       G_ALAE
    LRSSUMMARY:ALAE_PAID                =       0
    LRSSUMMARY:TRANS_DATE               =       TODAYSDATE
    LRSSUMMARY:TRANS_CODE               =       16
    LRSSUMMARY:COMMENTS                 =       "Setup Reserve"/raw
    LRSSUMMARY:AMOUNT                   =       L_RESV
    LRSSUMMARY:REINS_CO                 =       0
    LRSSUMMARY:STATUS                   =       L_LRSSUMMARY_STATUS
    LRSSUMMARY:STATUS_DATE              =       TODAYSDATE
    lrssummary:coverage                 =       lrssetup:coverage/raw
    LRSSUMMARY:EXPANSION                =       ""/raw
    End

End

Procedure LRSSUMMARY_SUBCODE
Begin
Access LRSSUMMARY_ALT, Set LRSSUMMARY_ALT:COMPANY_ID         = LRSSETUP:COMPANY_ID,
                           LRSSUMMARY_ALT:LINE_OF_BUSINESS   = LRSSETUP:LINE_OF_BUSINESS,
                           LRSSUMMARY_ALT:LOB_SUBLINE        = LRSSETUP:LOB_SUBLINE,
                           LRSSUMMARY_ALT:CLAIM_NO           = LRSSETUP:CLAIM_NO,
                           LRSSUMMARY_ALT:CAUSE_OF_LOSS      = LRSSETUP:CAUSE_OF_LOSS,
                           LRSSUMMARY_ALT:CAUSE_LOSS_SUBLINE = LRSSETUP:CAUSE_LOSS_SUBLINE,
                           LRSSUMMARY_ALT:TRANS_TYPE         = L_TRANS_TYPE, Approximate

L_SUMMARY_SUB_CODE = 0
While LRSSUMMARY_ALT:COMPANY_ID         = LRSSETUP:COMPANY_ID And
      LRSSUMMARY_ALT:CLAIM_NO           = LRSSETUP:CLAIM_NO And
      LRSSUMMARY_ALT:LINE_OF_BUSINESS   = LRSSETUP:LINE_OF_BUSINESS And
      LRSSUMMARY_ALT:LOB_SUBLINE        = LRSSETUP:LOB_SUBLINE And
      LRSSUMMARY_ALT:CAUSE_OF_LOSS      = LRSSETUP:CAUSE_OF_LOSS And
      LRSSUMMARY_ALT:CAUSE_LOSS_SUBLINE = LRSSETUP:CAUSE_LOSS_SUBLINE And
      LRSSUMMARY_ALT:TRANS_TYPE         = L_TRANS_TYPE
        Begin
        L_SUMMARY_SUB_CODE = LRSSUMMARY_ALT:SUB_CODE + 10

        Next LRSSUMMARY_ALT
        End

L_SUMMARY_SUB_CODE = L_SUMMARY_SUB_CODE + 10
End

Procedure SETUP_LRSCMNT
Begin
access sfpcurrent, set sfpcurrent:policy_no = lrssetup:policy_no, generic

access sfpname, set sfpname:policy_no    = lrssetup:policy_no,
                    sfpname:pol_Year     = sfpcurrent:pol_year,
                    sfpname:end_sequence = sfpcurrent:end_sequence, generic

Add LRSCMNT
    Begin
    LRSCMNT:COMPANY_ID          =       LRSSETUP:COMPANY_ID
    LRSCMNT:CLAIM_NO            =       LRSSETUP:CLAIM_NO
    LRSCMNT:SUB_CODE            =       L_CMNT_SUB_CODE
    If SFSCAUSE:LINE_TYPE not one of "W", "L" Then
        Begin
        LRSCMNT:NAME[1]         =       SFPNAME:NAME[1]
        LRSCMNT:NAME[2]         =       SFPNAME:NAME[2]
        LRSCMNT:NAME[3]         =       SFPNAME:NAME[3]
        LRSCMNT:ADDRESS[1]      =       SFPNAME:ADDRESS[1]
        LRSCMNT:ADDRESS[2]      =       SFPNAME:ADDRESS[2]
        LRSCMNT:ADDRESS[3]      =       SFPNAME:ADDRESS[3]
        LRSCMNT:CITY            =       SFPNAME:CITY
        LRSCMNT:STR_STATE       =       SFPNAME:STR_STATE
        LRSCMNT:STR_ZIPCODE     =       SFPNAME:STR_ZIPCODE
        End
    Else
        LRSCMNT:NAME[1]         =       LRSSETUP:CLAIMANT
    End

End

Procedure LRSCMNT_SUBCODE
Begin
Access LRSCMNT, Set LRSCMNT:COMPANY_ID = LRSSETUP:COMPANY_ID ,
                    LRSCMNT:CLAIM_NO   = LRSSETUP:CLAIM_NO , Generic

L_CMNT_SUB_CODE = 0
While LRSCMNT:COMPANY_ID = LRSSETUP:COMPANY_ID And
      LRSCMNT:CLAIM_NO   = LRSSETUP:CLAIM_NO
        Begin
        L_CMNT_SUB_CODE = LRSCMNT:SUB_CODE

        Next LRSCMNT
        End

L_CMNT_SUB_CODE = L_CMNT_SUB_CODE + 10
End

Procedure CHANGE_LRSDETAIL
Begin

L_COMMANDLINE = Str(LRSSETUP:CLAIM_NO,11) + uppercase(trun(LRSSETUP:COMPANY_ID))

If SFSCOMPANY:DEBUG_MODE = 0 Then
    Proc("csbatch lrsup100 %s",l_commandline)/noconsole
Else
    Proc("csbatch lrsup100 %s",l_commandline)

End

Procedure PROCESS_REINSURANCE
Begin
/* reinsurance processing, added july 10, 2001 (dlp) */

L_REIN_COMPANY_ID = LRSSUMMARY:COMPANY_ID/spacefill
L_REINS_OUTFILE = "lrsup600.out"
Deletefile(L_REINS_OUTFILE)
Writefile (L_REINS_OUTFILE,"%s%s",LRSSETUP:COMPANY_ID,"<NL>")
Writefile (L_REINS_OUTFILE,"%n%s",LRSSETUP:CLAIM_NO,"<NL>")
Writefile (L_REINS_OUTFILE,"%n%s",LRSSETUP:LINE_OF_BUSINESS,"<NL>")
Writefile (L_REINS_OUTFILE,"%s%s",LRSSETUP:LOB_SUBLINE,"<NL>")
Writefile (L_REINS_OUTFILE,"%n%s",LRSSETUP:CAUSE_OF_LOSS,"<NL>")
Writefile (L_REINS_OUTFILE,"%s%s",LRSSETUP:CAUSE_LOSS_SUBLINE,"<NL>")
Closefile (L_REINS_OUTFILE)

If SFSCOMPANY:DEBUG_MODE = 0 Then
    Begin
    Proc ("lrscededwrk.mk")/noconsole
    Proc ("csbatch lrsup600")/noconsole
    End
Else
    Begin
    Proc ("lrscededwrk.mk")/noconsole
    Proc ("csbatch lrsup600")/noconsole
    End

Deletefile (L_REINS_OUTFILE)
End

Procedure GET_CLAIM_NO
Begin
I_CSEXEC_APPLICATION = "LRSCLAIM                 "
Include "lrscsexec.pro"

If LRSSETUP:CLAIM_NO = 0 Then
    LRSSETUP:CLAIM_NO = I_CSEXEC_NUMBER

End

Procedure GET_POLICY
Begin
Access SFPCURRENT, Set SFPCURRENT:POLICY_NO = LRSSETUP:POLICY_NO, Exact

Access SFPNAME, Set SFPNAME:POLICY_NO    = SFPCURRENT:POLICY_NO,
                    SFPNAME:POL_YEAR     = SFPCURRENT:POL_YEAR,
                    SFPNAME:END_SEQUENCE = SFPCURRENT:END_SEQUENCE, Generic

LRSSETUP:NAME[1]           = SFPNAME:NAME[1]
LRSSETUP:LINE_OF_BUSINESS  = SFPNAME:LINE_OF_BUSINESS
End

Procedure SETUP_LRSWORK
Begin
Do SUBCODE
if l_year = 0 then
    begin
    l_year = sfpcurrent:pol_year
    l_end_sequence = sfpcurrent:end_sequence
    end

Add LRSWORK
    Begin
    LRSWORK:COMPANY_ID          = LRSSETUP:COMPANY_ID
    LRSWORK:POLICY_NO           = LRSSETUP:POLICY_NO
    LRSWORK:POL_YEAR            = L_YEAR
    LRSWORK:END_SEQUENCE        = L_END_SEQUENCE
    LRSWORK:PREM_NO             = 0
    LRSWORK:BUILD_NO            = 0
    LRSWORK:SUB_CODE            = L_SUB_CODE
    LRSWORK:ADDRESS1            = "Not on File"
    LRSWORK:TRANS_EFF           = SFPMASTER:TRANS_EFF
    LRSWORK:TRANS_EXP           = SFPMASTER:TRANS_EXP
    LRSWORK:ALLOW_THEM_TO_CHANGE = 1
    End

Access SFPLOCATION, Set SFPLOCATION:POLICY_NO = LRSSETUP:POLICY_NO, Generic

While SFPLOCATION:POLICY_NO = LRSSETUP:POLICY_NO
    Begin
    Access SFPMASTER, Set SFPMASTER:POLICY_NO    = LRSSETUP:POLICY_NO ,
                          SFPMASTER:POL_YEAR     = SFPLOCATION:POL_YEAR ,
                          SFPMASTER:END_SEQUENCE = SFPLOCATION:END_SEQUENCE, Generic

    Access SFPNAME, Set SFPNAME:POLICY_NO    = LRSSETUP:POLICY_NO ,
                        SFPNAME:POL_YEAR     = SFPLOCATION:POL_YEAR ,
                        SFPNAME:END_SEQUENCE = SFPLOCATION:END_SEQUENCE, Generic

    Access SFPMASTER, Set SFPMASTER:POLICY_NO    = LRSSETUP:POLICY_NO ,
                          SFPMASTER:POL_YEAR     = sfplocation:pol_YEAR ,
                          SFPMASTER:END_SEQUENCE = sfplocation:END_SEQUENCE, Generic

    if sfpname:eff_date <= lrssetup:loss_date and
       sfpname:exp_date >= lrssetup:loss_date and
       sfpmaster:trans_eff <= lrssetup:loss_date and
       sfpmaster:trans_exp >= lrssetup:loss_date then
        Begin
        Do SUBCODE
        L_YEAR = SFPLOCATION:POL_YEAR
        L_END_SEQUENCE = SFPLOCATION:END_SEQUENCE
        L_STATE = SFPLOCATION:STATE
        Add LRSWORK
            Begin
            LRSWORK:COMPANY_ID           = LRSSETUP:COMPANY_ID
            LRSWORK:POLICY_NO            = SFPLOCATION:POLICY_NO
            LRSWORK:POL_YEAR             = SFPLOCATION:POL_YEAR
            LRSWORK:END_SEQUENCE         = SFPLOCATION:END_SEQUENCE
            LRSWORK:PREM_NO              = SFPLOCATION:PREM_NO
            LRSWORK:BUILD_NO             = SFPLOCATION:BUILD_NO
            LRSWORK:SUB_CODE             = L_SUB_CODE
            LRSWORK:ADDRESS1             = trun(SFPLOCATION:ADDRESS) + " " +
                                           trun(SFPLOCATION:CITY) + ", " +
                                           SFPLOCATION:STR_STATE
            LRSWORK:TRANS_EFF            = SFPMASTER:TRANS_EFF
            LRSWORK:TRANS_EXP            = SFPMASTER:TRANS_EXP
            LRSWORK:ALLOW_THEM_TO_CHANGE = 0
            lrswork:state                = sfplocation:state
            End
        End

    Next SFPLOCATION
    End

if sfsline:lob_code one of "WORK" then
    begin
    access wcpgeneral, set wcpgeneral:policy_no = lrssetup:policy_no,
                           wcpgeneral:pol_year = l_year,
                           wcpgeneral:end_sequence = l_end_sequence, generic

    Access SFPMASTER, Set SFPMASTER:POLICY_NO    = LRSSETUP:POLICY_NO ,
                          SFPMASTER:POL_YEAR     = L_YEAR ,
                          SFPMASTER:END_SEQUENCE = L_END_SEQUENCE, Generic

    Access SFPNAME, Set SFPNAME:POLICY_NO    = LRSSETUP:POLICY_NO ,
                        SFPNAME:POL_YEAR     = L_YEAR ,
                        SFPNAME:END_SEQUENCE = L_END_SEQUENCE, Generic

    if sfpname:eff_date <= lrssetup:loss_date and
       sfpname:exp_date >= lrssetup:loss_date and
       sfpmaster:trans_eff <= lrssetup:loss_date and
       sfpmaster:trans_exp >= lrssetup:loss_date then
        Begin
        Do SUBCODE
        L_YEAR = sfpname:POL_YEAR
        L_END_SEQUENCE = sfpname:END_SEQUENCE
        L_STATE = wcpgeneral:state
        Add LRSWORK
            Begin
            LRSWORK:COMPANY_ID           = LRSSETUP:COMPANY_ID
            LRSWORK:POLICY_NO            = sfpname:POLICY_NO
            LRSWORK:POL_YEAR             = sfpname:POL_YEAR
            LRSWORK:END_SEQUENCE         = sfpname:END_SEQUENCE
            LRSWORK:PREM_NO              = 0
            LRSWORK:BUILD_NO             = 0
            LRSWORK:SUB_CODE             = L_SUB_CODE
            LRSWORK:ADDRESS1             = trun(sfpname:ADDRESS[1]) + " " +
                                           trun(sfpname:CITY) + ", " +
                                           sfpname:STR_STATE
            LRSWORK:TRANS_EFF            = SFPMASTER:TRANS_EFF
            LRSWORK:TRANS_EXP            = SFPMASTER:TRANS_EXP
            LRSWORK:ALLOW_THEM_TO_CHANGE = 0
            lrswork:state                = wcpgeneral:state
            End
        end

    Access wcpworkplaces, Set wcpworkplaces:POLICY_NO = LRSSETUP:POLICY_NO, Generic

    While wcpworkplaces:POLICY_NO = LRSSETUP:POLICY_NO
        Begin
        Access SFPMASTER, Set SFPMASTER:POLICY_NO    = LRSSETUP:POLICY_NO ,
                              SFPMASTER:POL_YEAR     = wcpworkplaces:POL_YEAR ,
                              SFPMASTER:END_SEQUENCE = wcpworkplaces:END_SEQUENCE, Generic

        Access SFPNAME, Set SFPNAME:POLICY_NO    = LRSSETUP:POLICY_NO ,
                            SFPNAME:POL_YEAR     = wcpworkplaces:POL_YEAR ,
                            SFPNAME:END_SEQUENCE = wcpworkplaces:END_SEQUENCE, Generic

        Access SFPMASTER, Set SFPMASTER:POLICY_NO    = LRSSETUP:POLICY_NO ,
                              SFPMASTER:POL_YEAR     = wcpworkplaces:pol_YEAR ,
                              SFPMASTER:END_SEQUENCE = wcpworkplaces:END_SEQUENCE, Generic

        if sfpname:eff_date <= lrssetup:loss_date and
           sfpname:exp_date >= lrssetup:loss_date and
           sfpmaster:trans_eff <= lrssetup:loss_date and
           sfpmaster:trans_exp >= lrssetup:loss_date then
            Begin
            Do SUBCODE
            L_YEAR = wcpworkplaces:POL_YEAR
            L_END_SEQUENCE = wcpworkplaces:END_SEQUENCE
            L_STATE = wcpgeneral:state
            Add LRSWORK
                Begin
                LRSWORK:COMPANY_ID           = LRSSETUP:COMPANY_ID
                LRSWORK:POLICY_NO            = wcpworkplaces:POLICY_NO
                LRSWORK:POL_YEAR             = wcpworkplaces:POL_YEAR
                LRSWORK:END_SEQUENCE         = wcpworkplaces:END_SEQUENCE
                LRSWORK:PREM_NO              = wcpworkplaces:PREM_NO
                LRSWORK:BUILD_NO             = wcpworkplaces:BUILD_NO
                LRSWORK:SUB_CODE             = L_SUB_CODE
                LRSWORK:ADDRESS1             = trun(wcpworkplaces:ADDRESS) + " " +
                                               trun(wcpworkplaces:CITY) + ", " +
                                               wcpworkplaces:STR_STATE
                LRSWORK:TRANS_EFF            = SFPMASTER:TRANS_EFF
                LRSWORK:TRANS_EXP            = SFPMASTER:TRANS_EXP
                LRSWORK:ALLOW_THEM_TO_CHANGE = 0
                lrswork:state                = wcpgeneral:state
                End
            End

        Next wcpworkplaces
        end
    End


Access PLPADDPREM, Set PLPADDPREM:POLICY_NO = LRSSETUP:POLICY_NO, Generic

While PLPADDPREM:POLICY_NO = LRSSETUP:POLICY_NO
    Begin
    Access SFPMASTER, Set SFPMASTER:POLICY_NO    = LRSSETUP:POLICY_NO ,
                          SFPMASTER:POL_YEAR     = PLPADDPREM:POL_YEAR ,
                          SFPMASTER:END_SEQUENCE = PLPADDPREM:END_SEQUENCE, Generic

    Access SFPNAME, Set SFPNAME:POLICY_NO    = LRSSETUP:POLICY_NO ,
                        SFPNAME:POL_YEAR     = PLPADDPREM:POL_YEAR ,
                        SFPNAME:END_SEQUENCE = PLPADDPREM:END_SEQUENCE, Generic

    If ((Year(SFPNAME:EFF_DATE) = Year(LRSSETUP:LOSS_DATE) Or
       Year(SFPNAME:EXP_DATE) = Year(LRSSETUP:LOSS_DATE)) And
       SFPMASTER:TRANS_EFF <= LRSSETUP:LOSS_DATE) Then
        Begin
        Do SUBCODE
        Add LRSWORK
            Begin
            LRSWORK:COMPANY_ID          = LRSSETUP:COMPANY_ID
            LRSWORK:POLICY_NO           = PLPADDPREM:POLICY_NO
            LRSWORK:POL_YEAR            = PLPADDPREM:POL_YEAR
            LRSWORK:END_SEQUENCE        = PLPADDPREM:END_SEQUENCE
            LRSWORK:PREM_NO             = PLPADDPREM:PREM_NO
            LRSWORK:BUILD_NO            = PLPADDPREM:BUILD_NO
            LRSWORK:SUB_CODE            = L_SUB_CODE
            LRSWORK:ADDRESS1            = Trun(Str(PLPADDPREM:ST_NUMBER)) + " " +
                                          Trun(PLPADDPREM:STREET) + " " +
                                          trun(PLPADDPREM:CITY) + ", " +
                                          PLPADDPREM:STR_STATE
            LRSWORK:TRANS_EFF           = SFPMASTER:TRANS_EFF
            LRSWORK:TRANS_EXP           = SFPMASTER:TRANS_EXP
            LRSWORK:ALLOW_THEM_TO_CHANGE = 0
            End
        End

    Next PLPADDPREM
    End

End

Procedure SUBCODE
Begin
Access LRSWORK_ALIAS, Set LRSWORK_ALIAS:COMPANY_ID = LRSSETUP:COMPANY_ID,
                          LRSWORK_ALIAS:POLICY_NO  = LRSSETUP:POLICY_NO, Generic

L_SUB_CODE = 0
While LRSWORK_ALIAS:COMPANY_ID = LRSSETUP:COMPANY_ID And
      LRSWORK_ALIAS:POLICY_NO  = LRSSETUP:POLICY_NO
       Begin
       L_SUB_CODE = LRSWORK_ALIAS:SUB_CODE

       Next LRSWORK_ALIAS
       End

L_SUB_CODE = L_SUB_CODE + 10

End

Procedure CHECK_SFPNAME
Begin
Access SFPNAME, Set SFPNAME:POLICY_NO = LRSSETUP:POLICY_NO, Generic

L_VALID_POLICY = "N"
L_CANCELLED = "N"
l_pre_filled = "N"
While SFPNAME:POLICY_NO = LRSSETUP:POLICY_NO
    Begin
    If SFPNAME:EFF_DATE <= LRSSETUP:LOSS_DATE And
       SFPNAME:EXP_DATE >= LRSSETUP:LOSS_DATE Then
        Begin
        if sfpname:pre_filled = 1 then
            l_valid_policy = "N"
        else
            L_VALID_POLICY = "Y"
        l_pre_filled = "Y"
        If SFPNAME:STATUS = "LOSSES" Then
            LRSSETUP:IDP_POLICY = "Y"
        Else
            LRSSETUP:IDP_POLICY = "N"
        LRSSETUP:POL_YEAR = SFPNAME:POL_YEAR
        LRSSETUP:END_SEQUENCE = SFPNAME:END_SEQUENCE
        LRSSETUP:NAME[1] = SFPNAME:NAME[1]
        LRSSETUP:LINE_OF_BUSINESS = SFPNAME:LINE_OF_BUSINESS
        LRSSETUP:AGENT_NO = SFPNAME:AGENT_NO
        LRSSETUP:EFF_DATE = SFPNAME:EFF_DATE
        If SFPNAME:STATUS = "CANCELLED" And
           SFPNAME:STATUS_DATE <= LRSSETUP:LOSS_DATE Then
            Begin
            LRSSETUP:STATUS = "X"
            LRSSETUP:STATUS_DATE = SFPNAME:STATUS_DATE
            L_CANCELLED     = "Y"
            End
        Else
            Begin
            LRSSETUP:STATUS = "O"
            LRSSETUP:STATUS_DATE = TODAYSDATE
            L_CANCELLED     = "N"
            End
        End
    else
    if sfpname:status = "CANCELLED" and
       sfpname:status_date <= lrssetup:loss_date then
        begin
        LRSSETUP:POL_YEAR = SFPNAME:POL_YEAR
        LRSSETUP:END_SEQUENCE = SFPNAME:END_SEQUENCE
        LRSSETUP:NAME[1] = SFPNAME:NAME[1]
        LRSSETUP:LINE_OF_BUSINESS = SFPNAME:LINE_OF_BUSINESS
        LRSSETUP:AGENT_NO = SFPNAME:AGENT_NO
        LRSSETUP:EFF_DATE = SFPNAME:EFF_DATE
        l_valid_policy = "Y"
        LRSSETUP:STATUS = "X"
        LRSSETUP:STATUS_DATE = SFPNAME:STATUS_DATE
        l_cancelled = "Y"
        end

    Next SFPNAME
    End

End

Procedure UPDATE_SFPNAME
Begin
access sfpcurrent, set sfpcurrent:policy_no = lrssetup:policy_no, generic

Access SFPNAME, Set SFPNAME:POLICY_NO    = LRSSETUP:POLICY_NO ,
                    SFPNAME:POL_YEAR     = sfpcurrent:POL_YEAR ,
                    SFPNAME:END_SEQUENCE = sfpcurrent:END_SEQUENCE ,Exact

If SFPNAME:POLICY_NO    = LRSSETUP:POLICY_NO And
   SFPNAME:POL_YEAR     = sfpcurrent:POL_YEAR And
   SFPNAME:END_SEQUENCE = sfpcurrent:END_SEQUENCE Then
    Change SFPNAME
        Begin
        SFPNAME:NUMBER_OF_CLAIMS       =       SFPNAME:NUMBER_OF_CLAIMS + 1
        End

End

Procedure DECREASE_SFPNAME
Begin
access sfpcurrent, set sfpcurrent:policy_no = l_hold_policy_no, generic

Access SFPNAME, Set SFPNAME:POLICY_NO    = l_hold_POLICY_NO ,
                    SFPNAME:POL_YEAR     = sfpcurrent:POL_YEAR ,
                    SFPNAME:END_SEQUENCE = sfpcurrent:END_SEQUENCE ,Exact

If SFPNAME:POLICY_NO    = l_hold_POLICY_NO And
   SFPNAME:POL_YEAR     = sfpcurrent:POL_YEAR And
   SFPNAME:END_SEQUENCE = sfpcurrent:END_SEQUENCE Then
    Change SFPNAME
        Begin
        SFPNAME:NUMBER_OF_CLAIMS       =       SFPNAME:NUMBER_OF_CLAIMS - 1
        End

End

Procedure SCIPS_MACRO
Begin
I_SCIPS_SELECT = "Y"

If I_SCIPS_SELECT = "Y" Then
    Begin
    I_SCIPS_PARAM_NAME = Lowercase(Trun(PROGRAMID)) + Trun(Str(PID)) + ".par"
    deletefile(i_scips_param_name)
    Writefile(I_SCIPS_PARAM_NAME,"%n<nl>",LRSSETUP:CLAIM_NO)
    closefile(i_scips_param_name)
    End

Include "lrsstatusprt.pro"

Procedure UPDATE_LRSSUMMARY_LAE
Begin

Proc ("csbatch lrsup101 %s %s",Str(LRSSETUP:CLAIM_NO,"99999999999"),Uppercase(LRSSETUP:COMPANY_ID))

End

/* Events Procedures Only Go below here */

Procedure Show_CAT
begin

g_company_id = lrssetup:company_id
g_cat_no     = lrssetup:cat_no
display modal screen "lrsmt108"

end

Procedure Show_CAT_STR
begin

g_company_id = lrssetup:company_id
g_str_cat_no = lrssetup:str_cat_no
display modal screen "lrsmt108a"

end

Procedure Show_pa
begin

g_company_id    = lrssetup:company_id
g_pub_adjust_no = lrssetup:pub_adjust_no
display modal screen "lrsmt107"

end

Procedure Show_accounts_payable
begin

g_company_id    = lrssetup:company_id
g_claim_no      = lrssetup:claim_no
display modal screen "apsmt200"

end

Procedure Show_notes
begin

g_company_id    = lrssetup:company_id
g_claim_no      = lrssetup:claim_no
display modal screen "lrsno001"

end

Procedure Show_claimant
begin

g_company_id = lrssetup:company_id
g_claim_no   = lrssetup:claim_no
display modal screen "lrsmt104"

end

Procedure Show_examiner
begin

g_company_id = lrssetup:company_id
g_vendor_no  = lrssetup:vendor_no[1]
display modal screen "sfsmt003"

end

Procedure Show_adjuster
begin

g_company_id = lrssetup:company_id
g_vendor_no  = lrssetup:vendor_no[2]
display modal screen "sfsmt003"

end

Procedure Show_coverage_opinion
begin

g_company_id = lrssetup:company_id
g_vendor_no  = lrssetup:vendor_no[5]
display modal screen "sfsmt003"

end

Procedure Show_litigation
begin

g_company_id = lrssetup:company_id
g_vendor_no  = lrssetup:vendor_no[3]
display modal screen "sfsmt003"

end

Procedure Show_dj
begin

g_company_id = lrssetup:company_id
g_vendor_no  = lrssetup:vendor_no[4]
display modal screen "sfsmt003"

end

Procedure Show_plaintiff_attorney
begin

g_company_id = lrssetup:company_id
g_vendor_no  = lrssetup:plantiff_vendor
display modal screen "sfsmt003"

end

Procedure Show_subro_salvage
begin

g_company_id = lrssetup:company_id
g_vendor_no  = lrssetup:vendor_no[6]
display modal screen "sfsmt003"

end

End
